<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Free space | Portfolio Laurine Seelt" />
<meta property="og:type" content="book" />




<meta name="author" content="Laurine Seelt" />

<meta name="date" content="2022-06-19" />


<meta name="description" content="Free space | Portfolio Laurine Seelt">

<title>Free space | Portfolio Laurine Seelt</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="data-wrangling.html#data-wrangling" id="toc-data-wrangling">Data wrangling</a></li>
<li><a href="reproducing-code.html#reproducing-code" id="toc-reproducing-code">Reproducing code</a></li>
<li><a href="cleaning-up.html#cleaning-up" id="toc-cleaning-up">Cleaning up</a></li>
<li><a href="cv.html#cv" id="toc-cv">CV</a></li>
<li><a href="free-space.html#free-space" id="toc-free-space">Free space</a></li>
<li><a href="zotero.html#zotero" id="toc-zotero">Zotero</a></li>
<li><a href="github.html#github" id="toc-github">GitHub</a></li>
<li><a href="sql.html#sql" id="toc-sql">SQL</a></li>
<li><a href="package.html#package" id="toc-package">Package</a></li>
<li><a href="ireland_params.html#ireland_params" id="toc-ireland_params">ireland_params</a></li>
<li><a href="belgium_params.html#belgium_params" id="toc-belgium_params">belgium_params</a></li>
<li><a href="austria_params.html#austria_params" id="toc-austria_params">austria_params</a></li>
<li><a href="bibliography.html#bibliography" id="toc-bibliography">Bibliography</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="free-space" class="section level1">
<h1>Free space</h1>
<p>I had 32 hours to learn something new that will be useful for my internship next year and possibly my job.</p>
<p>I decided I wanted to gain more experience in analysing microbiota data, because I’d like to work with bacteria in my future job. So, I searched the internet for packages and such, and found a course about microbiota analysis that I decided to follow.
<br>
Link to the course: <a href="https://rstudio-pubs-static.s3.amazonaws.com/268156_d3ea37937f4f4469839ab6fa2c483842.html" class="uri">https://rstudio-pubs-static.s3.amazonaws.com/268156_d3ea37937f4f4469839ab6fa2c483842.html</a>
<br>
<br></p>
<p><strong>Course: Microbiota analysis in R</strong></p>
<p><br>
In this course, we will be looking at the fecal bacterial microbiota of 8 calves at ages 2 weeks, 8 weeks and 1 year old and correlating them with variables such as weight gain, expressed as Average Daily Gain in Kilograms(ADGKG), and gastrointestinal short chain fatty acids, SCFA.
<br></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="free-space.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;ape&quot;)</span></span>
<span id="cb14-2"><a href="free-space.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb14-3"><a href="free-space.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb14-4"><a href="free-space.html#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-5"><a href="free-space.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb14-6"><a href="free-space.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gplots)</span>
<span id="cb14-7"><a href="free-space.html#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb14-8"><a href="free-space.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phangorn)</span>
<span id="cb14-9"><a href="free-space.html#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb14-10"><a href="free-space.html#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb14-11"><a href="free-space.html#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb14-12"><a href="free-space.html#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb14-13"><a href="free-space.html#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;VennDiagram&quot;)</span></span>
<span id="cb14-14"><a href="free-space.html#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VennDiagram)</span>
<span id="cb14-15"><a href="free-space.html#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Installed Java from: https://www.java.com/en/download/manual.jsp</span></span>
<span id="cb14-16"><a href="free-space.html#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Installed Java JDk from: https://www.oracle.com/java/technologies/downloads/#jdk18-windows</span></span>
<span id="cb14-17"><a href="free-space.html#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;rJava&quot;)</span></span>
<span id="cb14-18"><a href="free-space.html#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rJava)</span>
<span id="cb14-19"><a href="free-space.html#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;venneuler&quot;)</span></span>
<span id="cb14-20"><a href="free-space.html#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># library(venneuler) # R kapt er steeds mee als ik deze wil laden</span></span>
<span id="cb14-21"><a href="free-space.html#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># if (!require(&quot;BiocManager&quot;, quietly = TRUE))</span></span>
<span id="cb14-22"><a href="free-space.html#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># install.packages(&quot;BiocManager&quot;)</span></span>
<span id="cb14-23"><a href="free-space.html#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co"># BiocManager::install(version = &quot;3.15&quot;) # Instead of source(&quot;https://bioconductor.org/biocLite.R&quot;)</span></span>
<span id="cb14-24"><a href="free-space.html#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># BiocManager::install(&quot;phyloseq&quot;) # Instead of biocLite(&quot;phyloseq&quot;) ?</span></span>
<span id="cb14-25"><a href="free-space.html#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phyloseq)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="free-space.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Downloaded the data from: https://github.com/kdillmcfarland/workshops_UW_Madison/tree/master/Microbiota_analysis_R/Data</span></span>
<span id="cb15-2"><a href="free-space.html#cb15-2" aria-hidden="true" tabindex="-1"></a>OTU <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">&quot;Data/example.final.an.unique_list.0.03.norm.shared.txt&quot;</span>, </span>
<span id="cb15-3"><a href="free-space.html#cb15-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">header =</span> <span class="cn">TRUE</span>, </span>
<span id="cb15-4"><a href="free-space.html#cb15-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb15-5"><a href="free-space.html#cb15-5" aria-hidden="true" tabindex="-1"></a>tax <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">&quot;Data/example.final.an.unique_list.0.03.cons.taxonomy.txt&quot;</span>, </span>
<span id="cb15-6"><a href="free-space.html#cb15-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">header =</span> <span class="cn">TRUE</span>, </span>
<span id="cb15-7"><a href="free-space.html#cb15-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb15-8"><a href="free-space.html#cb15-8" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">&quot;Data/example.metadata.txt&quot;</span>, </span>
<span id="cb15-9"><a href="free-space.html#cb15-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">header =</span> <span class="cn">TRUE</span>, </span>
<span id="cb15-10"><a href="free-space.html#cb15-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">row.names =</span> <span class="dv">1</span>, </span>
<span id="cb15-11"><a href="free-space.html#cb15-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb15-12"><a href="free-space.html#cb15-12" aria-hidden="true" tabindex="-1"></a>SCFA <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">&quot;Data/example.SCFA.txt&quot;</span>, </span>
<span id="cb15-13"><a href="free-space.html#cb15-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">header =</span> <span class="cn">TRUE</span>, </span>
<span id="cb15-14"><a href="free-space.html#cb15-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">row.names =</span> <span class="dv">1</span>, </span>
<span id="cb15-15"><a href="free-space.html#cb15-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="free-space.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting the &quot;Group&quot; column as row names in the OTU dataset</span></span>
<span id="cb16-2"><a href="free-space.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(OTU) <span class="ot">=</span> OTU<span class="sc">$</span>Group</span>
<span id="cb16-3"><a href="free-space.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing the columns that are not OTU counts</span></span>
<span id="cb16-4"><a href="free-space.html#cb16-4" aria-hidden="true" tabindex="-1"></a>OTU.clean <span class="ot">=</span> OTU[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(OTU) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;label&quot;</span>, <span class="st">&quot;numOtus&quot;</span>, <span class="st">&quot;Group&quot;</span>))]</span>
<span id="cb16-5"><a href="free-space.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting the &quot;OTU&quot; column as row names in the taxonomy table</span></span>
<span id="cb16-6"><a href="free-space.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(tax) <span class="ot">=</span> tax<span class="sc">$</span>OTU</span>
<span id="cb16-7"><a href="free-space.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing the OTU&#39;s that aren&#39;t present in the OTU.clean dataset</span></span>
<span id="cb16-8"><a href="free-space.html#cb16-8" aria-hidden="true" tabindex="-1"></a>tax.clean <span class="ot">=</span> tax[<span class="fu">row.names</span>(tax) <span class="sc">%in%</span> <span class="fu">colnames</span>(OTU.clean),]</span>
<span id="cb16-9"><a href="free-space.html#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Separating the taxonomy table so each level has its own column</span></span>
<span id="cb16-10"><a href="free-space.html#cb16-10" aria-hidden="true" tabindex="-1"></a>tax.clean <span class="ot">=</span> <span class="fu">separate</span>(tax.clean, </span>
<span id="cb16-11"><a href="free-space.html#cb16-11" aria-hidden="true" tabindex="-1"></a>                     Taxonomy, </span>
<span id="cb16-12"><a href="free-space.html#cb16-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Domain&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;Class&quot;</span>, <span class="st">&quot;Order&quot;</span>, <span class="st">&quot;Family&quot;</span>, <span class="st">&quot;Genus&quot;</span>, <span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Strain&quot;</span>), </span>
<span id="cb16-13"><a href="free-space.html#cb16-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb16-14"><a href="free-space.html#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing the &quot;Size&quot;, &quot;Strain&quot; and &quot;OTU&quot; columns because these are now row names</span></span>
<span id="cb16-15"><a href="free-space.html#cb16-15" aria-hidden="true" tabindex="-1"></a>tax.clean <span class="ot">=</span> tax.clean[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(tax.clean) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Size&quot;</span>, <span class="st">&quot;Strain&quot;</span>, <span class="st">&quot;OTU&quot;</span>))]</span>
<span id="cb16-16"><a href="free-space.html#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Making sure the three datasets have samples in the same order</span></span>
<span id="cb16-17"><a href="free-space.html#cb16-17" aria-hidden="true" tabindex="-1"></a>OTU.clean <span class="ot">=</span> OTU.clean[<span class="fu">order</span>(<span class="fu">row.names</span>(OTU.clean)),]</span>
<span id="cb16-18"><a href="free-space.html#cb16-18" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">=</span> meta[<span class="fu">order</span>(<span class="fu">row.names</span>(meta)),]</span>
<span id="cb16-19"><a href="free-space.html#cb16-19" aria-hidden="true" tabindex="-1"></a>SCFA <span class="ot">=</span> SCFA[<span class="fu">order</span>(<span class="fu">row.names</span>(SCFA)),]</span>
<span id="cb16-20"><a href="free-space.html#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed to make the analysis reproducible</span></span>
<span id="cb16-21"><a href="free-space.html#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8765</span>)</span></code></pre></div>
<p><strong>Looking at the alpha diversity</strong>
<br>
Alpha diversity is the diversity <em>within</em> a sample. It looks at richness, which is the <em>amount</em> of OTU’s in each sample, and at evenness, which is how evenly the different OTU’s are distributed within the sample. <br></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="free-space.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a 2x2 plot environment so we can see all 4 metrics at once</span></span>
<span id="cb17-2"><a href="free-space.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb17-3"><a href="free-space.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the four metrics</span></span>
<span id="cb17-4"><a href="free-space.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>shannon, </span>
<span id="cb17-5"><a href="free-space.html#cb17-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Shannon diversity&quot;</span>, </span>
<span id="cb17-6"><a href="free-space.html#cb17-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb17-7"><a href="free-space.html#cb17-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb17-8"><a href="free-space.html#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>simpson, </span>
<span id="cb17-9"><a href="free-space.html#cb17-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Simpson diversity&quot;</span>, </span>
<span id="cb17-10"><a href="free-space.html#cb17-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb17-11"><a href="free-space.html#cb17-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb17-12"><a href="free-space.html#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>chao, </span>
<span id="cb17-13"><a href="free-space.html#cb17-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Chao richness&quot;</span>, </span>
<span id="cb17-14"><a href="free-space.html#cb17-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb17-15"><a href="free-space.html#cb17-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">15</span>)</span>
<span id="cb17-16"><a href="free-space.html#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>ace, </span>
<span id="cb17-17"><a href="free-space.html#cb17-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;ACE richness&quot;</span>, </span>
<span id="cb17-18"><a href="free-space.html#cb17-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb17-19"><a href="free-space.html#cb17-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/looking%20at%20the%20alpha%20diversity-1.png" width="672" />
<br>
None of the data are normally distributed. Simpson diversity is very often skewed as seen in this histogram, so we’ll calculate 1/Simpson and plot the metrics again.
<br></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="free-space.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a 2x2 environment</span></span>
<span id="cb18-2"><a href="free-space.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb18-3"><a href="free-space.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the four metrics again</span></span>
<span id="cb18-4"><a href="free-space.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>shannon, </span>
<span id="cb18-5"><a href="free-space.html#cb18-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Shannon diversity&quot;</span>, </span>
<span id="cb18-6"><a href="free-space.html#cb18-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb18-7"><a href="free-space.html#cb18-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb18-8"><a href="free-space.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="dv">1</span><span class="sc">/</span>meta<span class="sc">$</span>simpson, </span>
<span id="cb18-9"><a href="free-space.html#cb18-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Inverse Simpson diversity&quot;</span>, </span>
<span id="cb18-10"><a href="free-space.html#cb18-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb18-11"><a href="free-space.html#cb18-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb18-12"><a href="free-space.html#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>chao, </span>
<span id="cb18-13"><a href="free-space.html#cb18-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Chao richness&quot;</span>, </span>
<span id="cb18-14"><a href="free-space.html#cb18-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb18-15"><a href="free-space.html#cb18-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">15</span>)</span>
<span id="cb18-16"><a href="free-space.html#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>ace, </span>
<span id="cb18-17"><a href="free-space.html#cb18-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;ACE richness&quot;</span>, </span>
<span id="cb18-18"><a href="free-space.html#cb18-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb18-19"><a href="free-space.html#cb18-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-5-1.png" width="672" />
<br>
Now the Simpson diversity is distributed similarly to the other richness metrics.
<br>
Next, we’ll test the four metrics for normal distribution.
<br></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="free-space.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(meta<span class="sc">$</span>shannon)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  meta$shannon
## W = 0.91511, p-value = 0.0456</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="free-space.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="dv">1</span><span class="sc">/</span>meta<span class="sc">$</span>simpson)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  1/meta$simpson
## W = 0.74821, p-value = 4.69e-05</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="free-space.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(meta<span class="sc">$</span>chao)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  meta$chao
## W = 0.80636, p-value = 0.0003749</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="free-space.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(meta<span class="sc">$</span>ace)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  meta$ace
## W = 0.83017, p-value = 0.0009573</code></pre>
<p><br>
None of the richness metrics are normally distributed, which was to be expected from the graphs we’ve seen. So we cannot run any tests that assume the data is normally distributed.
<br>
For illustration purposes, we’ll run the ANOVA test with the Shannon’s diversity because that’s the closest to normally distributed. We’ll look at if age impacts the Shannon diversity of the fecal microbiota.
<br></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="free-space.html#cb27-1" aria-hidden="true" tabindex="-1"></a>aov.shannon.age <span class="ot">=</span> <span class="fu">aov</span>(shannon <span class="sc">~</span> AgeGroup, <span class="at">data =</span> meta)</span>
<span id="cb27-2"><a href="free-space.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aov.shannon.age)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## AgeGroup     2  42.98  21.489   103.4 1.35e-11 ***
## Residuals   21   4.36   0.208                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><br>
We’ll run Tukey’s honest significance test to do pairwise comparisons between groups and correct for multiple comparisons.
<br></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="free-space.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(aov.shannon.age)</span></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = shannon ~ AgeGroup, data = meta)
## 
## $AgeGroup
##             diff        lwr       upr   p adj
## 2w-1yr -3.270063 -3.8446230 -2.695503 0.0e+00
## 8w-1yr -1.830903 -2.4054628 -1.256342 2.0e-07
## 8w-2w   1.439160  0.8646001  2.013720 8.5e-06</code></pre>
<p><br>
It’s clear that all age groups have significantly different diversity. In a plot, we can clearly see that <em>diversity</em> increases with ages.
<br></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="free-space.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-ordering the groups</span></span>
<span id="cb31-2"><a href="free-space.html#cb31-2" aria-hidden="true" tabindex="-1"></a>meta<span class="sc">$</span>AgeGroup.ord <span class="ot">=</span> <span class="fu">factor</span>(meta<span class="sc">$</span>AgeGroup, <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>))</span>
<span id="cb31-3"><a href="free-space.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Returning the plot area to 1x1</span></span>
<span id="cb31-4"><a href="free-space.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb31-5"><a href="free-space.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the diversity</span></span>
<span id="cb31-6"><a href="free-space.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(shannon <span class="sc">~</span> AgeGroup.ord, </span>
<span id="cb31-7"><a href="free-space.html#cb31-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> meta, </span>
<span id="cb31-8"><a href="free-space.html#cb31-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Shannon&#39;s diversity&quot;</span>,</span>
<span id="cb31-9"><a href="free-space.html#cb31-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Age group&quot;</span>) <span class="co"># Added the xlab myself because it looks better :)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20the%20diversity-1.png" width="672" />
<br>
To illustrate some non-parametric tests, we’ll use Chao’s richness estimate. Age is categorical, so we’ll use Kruskal-Wallis.
<br></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="free-space.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(chao <span class="sc">~</span> AgeGroup, <span class="at">data =</span> meta)</span></code></pre></div>
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  chao by AgeGroup
## Kruskal-Wallis chi-squared = 19.28, df = 2, p-value = 6.507e-05</code></pre>
<p><br>
We can also test pairwise within age groups with Wilcoxon Rank Sum Tests.
<br></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="free-space.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.wilcox.test</span>(meta<span class="sc">$</span>chao, meta<span class="sc">$</span>AgeGroup, <span class="at">p.adjust.method =</span> <span class="st">&quot;fdr&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Pairwise comparisons using Wilcoxon rank sum exact test 
## 
## data:  meta$chao and meta$AgeGroup 
## 
##    1yr     2w     
## 2w 0.00023 -      
## 8w 0.00023 0.00186
## 
## P value adjustment method: fdr</code></pre>
<p><br>
Just like the diversity, <strong>richness</strong> also increases with age.
<br></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="free-space.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a 1x1 plot environment</span></span>
<span id="cb36-2"><a href="free-space.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb36-3"><a href="free-space.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the richness</span></span>
<span id="cb36-4"><a href="free-space.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(chao <span class="sc">~</span> AgeGroup.ord, <span class="at">data =</span> meta,</span>
<span id="cb36-5"><a href="free-space.html#cb36-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Chao richness&quot;</span>,</span>
<span id="cb36-6"><a href="free-space.html#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Age group&quot;</span>) <span class="co"># Again, added the xlab myself for aesthetics :)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20the%20richness-1.png" width="672" />
<br>
Average Daily Gain is a continuous variable, so we’ll use a linear model to visualise it.
<br>
We’ll use Shannon’s diversity again to run some tests that are meant for normally distributed data. We’ll take a look at if the ADG impacts the Shannon diversity of the fecal microbiota.
<br></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="free-space.html#cb37-1" aria-hidden="true" tabindex="-1"></a>glm.shannon.ADG <span class="ot">=</span> <span class="fu">glm</span>(shannon <span class="sc">~</span> ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb37-2"><a href="free-space.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.shannon.ADG)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = shannon ~ ADGKG, data = meta)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.49110  -1.11216  -0.01749   1.53658   1.84728  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  3.62565    1.01390   3.576  0.00169 **
## ADGKG       -0.03407    0.97805  -0.035  0.97253   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 2.151815)
## 
##     Null deviance: 47.343  on 23  degrees of freedom
## Residual deviance: 47.340  on 22  degrees of freedom
## AIC: 90.412
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p><br>
This shows that the intercept of our model is signficantly different from 0, bu the slope is not, and the slope is our variable of interest.
<br>
Next, let’s plot the glm.
<br></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="free-space.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(shannon <span class="sc">~</span> ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb39-2"><a href="free-space.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(glm.shannon.ADG)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20the%20glm-1.png" width="672" />
<br>
To illustrate non-normally distributed data, we’ll use Chao’s richness estimate again. We’ll first use the Gaussian distribution, but we already know this isn’t a good fit.
<br></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="free-space.html#cb40-1" aria-hidden="true" tabindex="-1"></a>gaussian.chao.adg <span class="ot">=</span> <span class="fu">glm</span>(chao <span class="sc">~</span>ADGKG, <span class="at">data =</span> meta, <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>)</span>
<span id="cb40-2"><a href="free-space.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb40-3"><a href="free-space.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gaussian.chao.adg, <span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20Gaussian-1.png" width="672" />
<br>
Next, we’ll plot the quasipoisson distribuiton.
<br></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="free-space.html#cb41-1" aria-hidden="true" tabindex="-1"></a>qp.chao.ADG <span class="ot">=</span> <span class="fu">glm</span>(chao <span class="sc">~</span> ADGKG, <span class="at">data =</span> meta, <span class="at">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span>
<span id="cb41-2"><a href="free-space.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb41-3"><a href="free-space.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(qp.chao.ADG, <span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20quasipoisson-1.png" width="672" />
<br>
The quasipoisson distribution fits much better than the Gaussian distribution, so we’ll use quasipoisson for further calculations.
<br></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="free-space.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(qp.chao.ADG)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = chao ~ ADGKG, family = &quot;quasipoisson&quot;, data = meta)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -24.36  -17.05  -10.66   18.81   26.91  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   6.4528     0.5561  11.605 7.54e-11 ***
## ADGKG        -0.1859     0.5438  -0.342    0.736    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 374.2485)
## 
##     Null deviance: 8117.2  on 23  degrees of freedom
## Residual deviance: 8074.4  on 22  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p><br>
We’ll plot Chao and ADGKG again, to look at the correlation.
<br></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="free-space.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb44-2"><a href="free-space.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(chao) <span class="sc">~</span> ADGKG, <span class="at">data =</span> meta, <span class="at">ylab =</span> <span class="st">&quot;ln(Chao&#39;s richness)&quot;</span>)</span>
<span id="cb44-3"><a href="free-space.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(qp.chao.ADG)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20Chao%20and%20ADGKG-1.png" width="672" />
<br>
Looking at the graph, there is nog significant correlation between Chao’s richness and the Average Daily Gain.
<br>
To test if age and ADG impacts diversity, we’ll conduct an ANOVA test.
<br></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="free-space.html#cb45-1" aria-hidden="true" tabindex="-1"></a>aov.shannon.all <span class="ot">=</span> <span class="fu">aov</span>(shannon <span class="sc">~</span> AgeGroup<span class="sc">*</span>ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb45-2"><a href="free-space.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aov.shannon.all)</span></code></pre></div>
<pre><code>##                Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## AgeGroup        2  42.98  21.489  95.472 2.61e-10 ***
## ADGKG           1   0.05   0.054   0.239    0.631    
## AgeGroup:ADGKG  2   0.26   0.130   0.576    0.572    
## Residuals      18   4.05   0.225                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><br>
We can see that the interaction between age and ADG does not significantly impact Shannon’s diversity, so we’ll remove that variable and run the test again.
<br></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="free-space.html#cb47-1" aria-hidden="true" tabindex="-1"></a>aov.shannon.all2 <span class="ot">=</span> <span class="fu">aov</span>(shannon <span class="sc">~</span> AgeGroup<span class="sc">+</span>ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb47-2"><a href="free-space.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aov.shannon.all2)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## AgeGroup     2  42.98  21.489   99.70 3.96e-11 ***
## ADGKG        1   0.05   0.054    0.25    0.623    
## Residuals   20   4.31   0.216                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><br>
This test tells us that only age impacts Shannon’s diversity significantly, but we do not know which age groups differ significantly from eachother. To test this, we can run TukeyHSD with just age.
<br></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="free-space.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(aov.shannon.all)</span></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = shannon ~ AgeGroup * ADGKG, data = meta)
## 
## $AgeGroup
##             diff       lwr       upr    p adj
## 2w-1yr -3.270063 -3.875469 -2.664657 0.00e+00
## 8w-1yr -1.830903 -2.436309 -1.225496 1.20e-06
## 8w-2w   1.439160  0.833754  2.044567 2.81e-05</code></pre>
<p><br>
With this test, however, ADGKG is ignored because it’s continuous. <br>
We’ll run the glm instead.
<br></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="free-space.html#cb51-1" aria-hidden="true" tabindex="-1"></a>glm.shannon.all <span class="ot">=</span> <span class="fu">glm</span>(shannon <span class="sc">~</span> AgeGroup<span class="sc">*</span>ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb51-2"><a href="free-space.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.shannon.all)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = shannon ~ AgeGroup * ADGKG, data = meta)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.0301  -0.2468   0.0894   0.1572   0.7624  
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)        5.7123     2.5928   2.203   0.0409 *
## AgeGroup2w        -3.3969     2.6197  -1.297   0.2111  
## AgeGroup8w        -2.9610     2.7554  -1.075   0.2967  
## ADGKG             -0.4481     2.7599  -0.162   0.8728  
## AgeGroup2w:ADGKG   0.1228     2.7848   0.044   0.9653  
## AgeGroup8w:ADGKG   1.0750     2.8763   0.374   0.7130  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.22508)
## 
##     Null deviance: 47.3425  on 23  degrees of freedom
## Residual deviance:  4.0514  on 18  degrees of freedom
## AIC: 39.413
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p><br>
We can see that none of the interaction terms, which are AgeGroup2w:ADGKG and AgeGroup8w:ADGKG, are significant. So we’ll remove these, by changing AgeGroup*ADGKG to AgeGroup+ADGKG, and run the glm again.
<br></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="free-space.html#cb53-1" aria-hidden="true" tabindex="-1"></a>glm.shannon.all2 <span class="ot">=</span> <span class="fu">glm</span>(shannon <span class="sc">~</span> AgeGroup<span class="sc">+</span>ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb53-2"><a href="free-space.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.shannon.all2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = shannon ~ AgeGroup + ADGKG, data = meta)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.95299  -0.25858   0.07643   0.30409   0.74487  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   5.4459     0.3487  15.619 1.14e-12 ***
## AgeGroup2w   -3.2760     0.2324 -14.094 7.55e-12 ***
## AgeGroup8w   -1.7989     0.2408  -7.471 3.30e-07 ***
## ADGKG        -0.1639     0.3281  -0.500    0.623    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.2155447)
## 
##     Null deviance: 47.3425  on 23  degrees of freedom
## Residual deviance:  4.3109  on 20  degrees of freedom
## AIC: 36.903
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p><br>
Now that we’ve removed the interaction terms, the glm model shows age as significant.
<br>
This can also be done with non-normally distributed data, like Chao’s richness.
<br></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="free-space.html#cb55-1" aria-hidden="true" tabindex="-1"></a>qp.chao.all <span class="ot">=</span> <span class="fu">glm</span>(chao <span class="sc">~</span> AgeGroup<span class="sc">*</span>ADGKG, <span class="at">data =</span> meta, <span class="at">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span>
<span id="cb55-2"><a href="free-space.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(qp.chao.all)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = chao ~ AgeGroup * ADGKG, family = &quot;quasipoisson&quot;, 
##     data = meta)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -7.774  -3.430  -0.140   3.692   5.277  
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       6.99825    0.71122   9.840 1.14e-08 ***
## AgeGroup2w       -1.61539    0.75272  -2.146   0.0458 *  
## AgeGroup8w       -2.24498    0.86846  -2.585   0.0187 *  
## ADGKG             0.01751    0.75699   0.023   0.9818    
## AgeGroup2w:ADGKG -0.42295    0.80094  -0.528   0.6039    
## AgeGroup8w:ADGKG  0.86269    0.86550   0.997   0.3321    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 18.86331)
## 
##     Null deviance: 8117.2  on 23  degrees of freedom
## Residual deviance:  348.5  on 18  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><br>
Just like the Shannon’s diversity, the interaction terms are not significant, so we’ll remove those and run the glm again.
<br></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="free-space.html#cb57-1" aria-hidden="true" tabindex="-1"></a>qp.chao.all2 <span class="ot">=</span> <span class="fu">glm</span>(chao <span class="sc">~</span> AgeGroup<span class="sc">+</span>ADGKG, <span class="at">data =</span> meta, <span class="at">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span>
<span id="cb57-2"><a href="free-space.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(qp.chao.all2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = chao ~ AgeGroup + ADGKG, family = &quot;quasipoisson&quot;, 
##     data = meta)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -7.783  -3.452  -1.378   3.744   8.184  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  7.03944    0.23567  29.870  &lt; 2e-16 ***
## AgeGroup2w  -1.98090    0.14862 -13.329 2.08e-11 ***
## AgeGroup8w  -1.24286    0.11926 -10.422 1.57e-09 ***
## ADGKG       -0.02643    0.24530  -0.108    0.915    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 23.74583)
## 
##     Null deviance: 8117.20  on 23  degrees of freedom
## Residual deviance:  476.31  on 20  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><br>
As we can see, age is now significant for richness aswell.
<br>
We sampled the same animals over time, so this is a repeated measures design. We can add this component with (1|animal) in the lmer function.
<br></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="free-space.html#cb59-1" aria-hidden="true" tabindex="-1"></a>rm.shannon.all <span class="ot">=</span> <span class="fu">lmer</span>(shannon <span class="sc">~</span> AgeGroup<span class="sc">+</span>ADGKG <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Animal), <span class="at">data =</span> meta)</span>
<span id="cb59-2"><a href="free-space.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rm.shannon.all)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: shannon ~ AgeGroup + ADGKG + (1 | Animal)
##    Data: meta
## 
## REML criterion at convergence: 32.4
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.83117 -0.45932  0.09539  0.49972  1.53368 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Animal   (Intercept) 0.03793  0.1948  
##  Residual             0.17819  0.4221  
## Number of obs: 24, groups:  Animal, 8
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   5.3906     0.3520  15.313
## AgeGroup2w   -3.2739     0.2114 -15.486
## AgeGroup8w   -1.8104     0.2208  -8.201
## ADGKG        -0.1049     0.3321  -0.316
## 
## Correlation of Fixed Effects:
##            (Intr) AgGrp2 AgGrp8
## AgeGroup2w -0.350              
## AgeGroup8w -0.027  0.461       
## ADGKG      -0.884  0.057 -0.293</code></pre>
<p><br>
Very little, 0.0379, of the variance is explained by the animal random effect. This means that we don’t have to include the repeated measures in our final model, but it did need to be checked!
<br>
In conclusion on the alpha diversity: The diversity and richness of the fecal microbiota increases as the dairy cows age. Animal growth, measured by ADG, does not correlate with the diversity or richness of the fecal community.
<br>
<br></p>
<p><strong>Looking at the beta diversity</strong>
<br>
Beta diversity looks at the dissimilarity <em>between</em> samples, instead of within a sample, like the alpha diversity.
<br>
First, we’ll calculate the non-metric multidimensional scaling using the Bray-Curtis metric. This metric takes into account the presence or absence of OTU’s and the abundance of the OTU’s that are present in the samples. So, this metric looks at richness and diversity.
<br></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="free-space.html#cb61-1" aria-hidden="true" tabindex="-1"></a>BC.nmds <span class="ot">=</span> <span class="fu">metaMDS</span>(OTU.clean, <span class="at">distance =</span> <span class="st">&quot;bray&quot;</span>, <span class="at">k=</span><span class="dv">2</span>, <span class="at">trymax =</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Square root transformation
## Wisconsin double standardization
## Run 0 stress 0.06208119 
## Run 1 stress 0.06210577 
## ... Procrustes: rmse 0.00142196  max resid 0.005448642 
## ... Similar to previous best
## Run 2 stress 0.06208123 
## ... Procrustes: rmse 0.0002939818  max resid 0.0006667466 
## ... Similar to previous best
## Run 3 stress 0.06208111 
## ... New best solution
## ... Procrustes: rmse 0.000204731  max resid 0.000465473 
## ... Similar to previous best
## Run 4 stress 0.0620811 
## ... New best solution
## ... Procrustes: rmse 1.986518e-05  max resid 4.33287e-05 
## ... Similar to previous best
## Run 5 stress 0.06208117 
## ... Procrustes: rmse 5.794984e-05  max resid 0.0001305115 
## ... Similar to previous best
## Run 6 stress 0.06208113 
## ... Procrustes: rmse 3.672359e-05  max resid 8.23805e-05 
## ... Similar to previous best
## Run 7 stress 0.06210572 
## ... Procrustes: rmse 0.001378329  max resid 0.005368037 
## ... Similar to previous best
## Run 8 stress 0.06210378 
## ... Procrustes: rmse 0.001413908  max resid 0.005105586 
## ... Similar to previous best
## Run 9 stress 0.06208125 
## ... Procrustes: rmse 0.0001224896  max resid 0.0002747291 
## ... Similar to previous best
## Run 10 stress 0.06208111 
## ... Procrustes: rmse 1.212188e-05  max resid 2.522293e-05 
## ... Similar to previous best
## Run 11 stress 0.06208121 
## ... Procrustes: rmse 0.0002127404  max resid 0.0004849115 
## ... Similar to previous best
## Run 12 stress 0.06210373 
## ... Procrustes: rmse 0.001425856  max resid 0.005115974 
## ... Similar to previous best
## Run 13 stress 0.3701749 
## Run 14 stress 0.06210382 
## ... Procrustes: rmse 0.001409512  max resid 0.005096637 
## ... Similar to previous best
## Run 15 stress 0.06208124 
## ... Procrustes: rmse 9.356523e-05  max resid 0.0002029152 
## ... Similar to previous best
## Run 16 stress 0.06210382 
## ... Procrustes: rmse 0.001453464  max resid 0.005117477 
## ... Similar to previous best
## Run 17 stress 0.06210562 
## ... Procrustes: rmse 0.001356805  max resid 0.005299213 
## ... Similar to previous best
## Run 18 stress 0.06208121 
## ... Procrustes: rmse 8.948438e-05  max resid 0.0001972643 
## ... Similar to previous best
## Run 19 stress 0.06208123 
## ... Procrustes: rmse 0.0001043305  max resid 0.0002338428 
## ... Similar to previous best
## Run 20 stress 0.06210572 
## ... Procrustes: rmse 0.00138274  max resid 0.005378219 
## ... Similar to previous best
## *** Solution reached</code></pre>
<p><br>
We’ve reached a convergent solution at around 20 iterations, and the stress is very low, 0.06. That means that 2 axis are sufficient to plot our data.
<br>
We’ll plot our data with different colors for each age group.
<br></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="free-space.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb63-2"><a href="free-space.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a blank plot for the nmds</span></span>
<span id="cb63-3"><a href="free-space.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BC.nmds, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Bray-Curtis&quot;</span>)</span>
<span id="cb63-4"><a href="free-space.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the points</span></span>
<span id="cb63-5"><a href="free-space.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(BC.nmds, </span>
<span id="cb63-6"><a href="free-space.html#cb63-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb63-7"><a href="free-space.html#cb63-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb63-8"><a href="free-space.html#cb63-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup] <span class="co"># [Meta$AgeGroup] buiten haakjes gehaald</span></span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="free-space.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding a legend</span></span>
<span id="cb65-2"><a href="free-space.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="fl">5.5</span>, <span class="fl">2.5</span>, </span>
<span id="cb65-3"><a href="free-space.html#cb65-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb65-4"><a href="free-space.html#cb65-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb65-5"><a href="free-space.html#cb65-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20BC%20nMDS-1.png" width="672" />
<br>
We can also calculate the nMDS for the Jaccard metric. This metric only looks at the presence or absence of OTU’s, so it only looks at richness.
<br></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="free-space.html#cb66-1" aria-hidden="true" tabindex="-1"></a>J.nmds <span class="ot">=</span> <span class="fu">metaMDS</span>(OTU.clean, <span class="at">distance =</span> <span class="st">&quot;jaccard&quot;</span>, <span class="at">k=</span><span class="dv">2</span>, <span class="at">trymax =</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Square root transformation
## Wisconsin double standardization
## Run 0 stress 0.06208109 
## Run 1 stress 0.0620812 
## ... Procrustes: rmse 0.000177083  max resid 0.0003999569 
## ... Similar to previous best
## Run 2 stress 0.06210582 
## ... Procrustes: rmse 0.001409216  max resid 0.005429768 
## ... Similar to previous best
## Run 3 stress 0.06210567 
## ... Procrustes: rmse 0.00137946  max resid 0.005369397 
## ... Similar to previous best
## Run 4 stress 0.06208119 
## ... Procrustes: rmse 0.0001744131  max resid 0.0003942546 
## ... Similar to previous best
## Run 5 stress 0.06208115 
## ... Procrustes: rmse 0.000130016  max resid 0.0002909929 
## ... Similar to previous best
## Run 6 stress 0.06208112 
## ... Procrustes: rmse 0.0001066234  max resid 0.0002384603 
## ... Similar to previous best
## Run 7 stress 0.0620811 
## ... Procrustes: rmse 9.468274e-05  max resid 0.0002141725 
## ... Similar to previous best
## Run 8 stress 0.0621059 
## ... Procrustes: rmse 0.001426217  max resid 0.005460826 
## ... Similar to previous best
## Run 9 stress 0.06208124 
## ... Procrustes: rmse 0.0002015441  max resid 0.0004545264 
## ... Similar to previous best
## Run 10 stress 0.0620812 
## ... Procrustes: rmse 0.0001797232  max resid 0.0004060386 
## ... Similar to previous best
## Run 11 stress 0.06208109 
## ... New best solution
## ... Procrustes: rmse 6.139566e-05  max resid 0.0001371443 
## ... Similar to previous best
## Run 12 stress 0.0621038 
## ... Procrustes: rmse 0.001406932  max resid 0.005095216 
## ... Similar to previous best
## Run 13 stress 0.06208126 
## ... Procrustes: rmse 0.0001414878  max resid 0.0003183287 
## ... Similar to previous best
## Run 14 stress 0.06208108 
## ... New best solution
## ... Procrustes: rmse 3.770942e-05  max resid 7.95009e-05 
## ... Similar to previous best
## Run 15 stress 0.06210568 
## ... Procrustes: rmse 0.001379045  max resid 0.005369661 
## ... Similar to previous best
## Run 16 stress 0.06208111 
## ... Procrustes: rmse 8.244032e-05  max resid 0.0001835168 
## ... Similar to previous best
## Run 17 stress 0.06208123 
## ... Procrustes: rmse 0.0001586643  max resid 0.0003545319 
## ... Similar to previous best
## Run 18 stress 0.06208122 
## ... Procrustes: rmse 0.0001644494  max resid 0.0003672165 
## ... Similar to previous best
## Run 19 stress 0.06208112 
## ... Procrustes: rmse 7.816312e-05  max resid 0.0001743423 
## ... Similar to previous best
## Run 20 stress 0.0620811 
## ... Procrustes: rmse 7.313823e-05  max resid 0.0001625506 
## ... Similar to previous best
## *** Solution reached</code></pre>
<p><br>
With this metric, we’ve also reached a convergent solution after 20 iterations. The stress is also very low for this metric, 0.06. So, we’ll plot this metric with 2 axis aswell.
<br></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="free-space.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(J.nmds, </span>
<span id="cb68-2"><a href="free-space.html#cb68-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb68-3"><a href="free-space.html#cb68-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Jaccard&quot;</span>)</span>
<span id="cb68-4"><a href="free-space.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(J.nmds, </span>
<span id="cb68-5"><a href="free-space.html#cb68-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb68-6"><a href="free-space.html#cb68-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb68-7"><a href="free-space.html#cb68-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup]</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="free-space.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="fl">1.5</span>, </span>
<span id="cb70-2"><a href="free-space.html#cb70-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb70-3"><a href="free-space.html#cb70-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb70-4"><a href="free-space.html#cb70-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20Jaccard%20nMDS-1.png" width="672" />
<br>
The values in the plot are somewhat different, but the distributions are very similar. That’s because Jaccard = 2xBray-Curtis/(1+Bray-Curtis).
<br>
We can also plot the standard error ellipses of the nMDS data. We’ll plot the 99% confidence interval of the Bray-Curtis metric.
<br></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="free-space.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BC.nmds, </span>
<span id="cb71-2"><a href="free-space.html#cb71-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb71-3"><a href="free-space.html#cb71-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Bray-Curtis&quot;</span>)</span>
<span id="cb71-4"><a href="free-space.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="fl">5.5</span>, <span class="fl">2.5</span>, </span>
<span id="cb71-5"><a href="free-space.html#cb71-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb71-6"><a href="free-space.html#cb71-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb71-7"><a href="free-space.html#cb71-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb71-8"><a href="free-space.html#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ellipse for 2 weeks</span></span>
<span id="cb71-9"><a href="free-space.html#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiellipse</span>(BC.nmds, </span>
<span id="cb71-10"><a href="free-space.html#cb71-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">groups =</span> meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb71-11"><a href="free-space.html#cb71-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb71-12"><a href="free-space.html#cb71-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">kind =</span> <span class="st">&quot;se&quot;</span>, </span>
<span id="cb71-13"><a href="free-space.html#cb71-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">conf =</span> <span class="fl">0.99</span>, </span>
<span id="cb71-14"><a href="free-space.html#cb71-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="cn">FALSE</span>, </span>
<span id="cb71-15"><a href="free-space.html#cb71-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, </span>
<span id="cb71-16"><a href="free-space.html#cb71-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">draw =</span> <span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb71-17"><a href="free-space.html#cb71-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">200</span>, </span>
<span id="cb71-18"><a href="free-space.html#cb71-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.groups =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>), </span>
<span id="cb71-19"><a href="free-space.html#cb71-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">border =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-20"><a href="free-space.html#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Ellipse for 8 weeks</span></span>
<span id="cb71-21"><a href="free-space.html#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiellipse</span>(BC.nmds, </span>
<span id="cb71-22"><a href="free-space.html#cb71-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">groups =</span> meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb71-23"><a href="free-space.html#cb71-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb71-24"><a href="free-space.html#cb71-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">kind =</span> <span class="st">&quot;se&quot;</span>, </span>
<span id="cb71-25"><a href="free-space.html#cb71-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">conf =</span> <span class="fl">0.99</span>, </span>
<span id="cb71-26"><a href="free-space.html#cb71-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="cn">FALSE</span>, </span>
<span id="cb71-27"><a href="free-space.html#cb71-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb71-28"><a href="free-space.html#cb71-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">draw =</span> <span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb71-29"><a href="free-space.html#cb71-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">200</span>, </span>
<span id="cb71-30"><a href="free-space.html#cb71-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.groups =</span> <span class="fu">c</span>(<span class="st">&quot;8w&quot;</span>), </span>
<span id="cb71-31"><a href="free-space.html#cb71-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">border =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-32"><a href="free-space.html#cb71-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ELLipse for 1 year</span></span>
<span id="cb71-33"><a href="free-space.html#cb71-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiellipse</span>(BC.nmds, </span>
<span id="cb71-34"><a href="free-space.html#cb71-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">groups =</span> meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb71-35"><a href="free-space.html#cb71-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb71-36"><a href="free-space.html#cb71-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">kind =</span> <span class="st">&quot;se&quot;</span>, </span>
<span id="cb71-37"><a href="free-space.html#cb71-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">conf =</span> <span class="fl">0.99</span>, </span>
<span id="cb71-38"><a href="free-space.html#cb71-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="cn">FALSE</span>, </span>
<span id="cb71-39"><a href="free-space.html#cb71-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb71-40"><a href="free-space.html#cb71-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">draw =</span> <span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb71-41"><a href="free-space.html#cb71-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">200</span>, </span>
<span id="cb71-42"><a href="free-space.html#cb71-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.groups =</span> <span class="fu">c</span>(<span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb71-43"><a href="free-space.html#cb71-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">border =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20ellipses-1.png" width="672" />
<br>
If the stress is high, over 0.3, it’s better to increase to 3 axes.
<br>
We’ll first calculate the Bray-Curtis nMDS for a 3-axis plot.
<br></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="free-space.html#cb72-1" aria-hidden="true" tabindex="-1"></a>BC.nmds<span class="fl">.3</span>D <span class="ot">=</span> <span class="fu">metaMDS</span>(OTU.clean, <span class="at">distance =</span> <span class="st">&quot;bray&quot;</span>, <span class="at">k=</span><span class="dv">3</span>, <span class="at">trymax=</span><span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Square root transformation
## Wisconsin double standardization
## Run 0 stress 0.04686211 
## Run 1 stress 0.04741561 
## Run 2 stress 0.04673316 
## ... New best solution
## ... Procrustes: rmse 0.01078619  max resid 0.03453509 
## Run 3 stress 0.05061342 
## Run 4 stress 0.04740116 
## Run 5 stress 0.04984351 
## Run 6 stress 0.04747471 
## Run 7 stress 0.05226505 
## Run 8 stress 0.0529536 
## Run 9 stress 0.04741183 
## Run 10 stress 0.04575764 
## ... New best solution
## ... Procrustes: rmse 0.03871705  max resid 0.1297458 
## Run 11 stress 0.05084344 
## Run 12 stress 0.04719045 
## Run 13 stress 0.04864532 
## Run 14 stress 0.04750072 
## Run 15 stress 0.04793837 
## Run 16 stress 0.04579474 
## ... Procrustes: rmse 0.004492898  max resid 0.01438546 
## Run 17 stress 0.05069325 
## Run 18 stress 0.04857979 
## Run 19 stress 0.05058111 
## Run 20 stress 0.04859455 
## Run 21 stress 0.04996549 
## Run 22 stress 0.04739851 
## Run 23 stress 0.04747497 
## Run 24 stress 0.04675354 
## Run 25 stress 0.04747484 
## Run 26 stress 0.04861683 
## Run 27 stress 0.04575768 
## ... Procrustes: rmse 0.0001087933  max resid 0.0001902161 
## ... Similar to previous best
## *** Solution reached</code></pre>
<p><br>
We’ll extract the x, y and z for the nMDS, and then plot them.
<br></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="free-space.html#cb74-1" aria-hidden="true" tabindex="-1"></a>BCxyz <span class="ot">=</span> <span class="fu">scores</span>(BC.nmds<span class="fl">.3</span>D, <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb74-2"><a href="free-space.html#cb74-2" aria-hidden="true" tabindex="-1"></a>BCxyz</span></code></pre></div>
<pre><code>##                 NMDS1       NMDS2        NMDS3
## 5017.1yr.F -4.7877193  0.32878559 -0.204579523
## 5017.2w.F   3.1847627  0.05697846  1.484325743
## 5017.8w.F   1.0503489 -2.11932201 -1.217100783
## 5020.1yr.F -4.7466509  0.24479143 -0.001927473
## 5020.2w.F   3.4956397 -1.01621364  1.008439783
## 5020.8w.F   1.5785763 -1.92688899  0.465285369
## 5026.1yr.F -4.7617021  0.20961333  0.209854984
## 5026.2w.F   3.3964195  1.09611959 -0.615338225
## 5026.8w.F   3.1475032  2.07012741  1.477070476
## 5031.1yr.F -4.7920071  0.44153808  0.196685523
## 5031.2w.F   3.3507672  0.48092133 -1.491382237
## 5031.8w.F   0.8516766 -1.63544389  0.254264412
## 5037.1yr.F -4.8418075  0.48746059 -0.004313703
## 5037.2w.F   3.6570393  0.26299035 -0.511188778
## 5037.8w.F   3.1287853 -0.82431199 -0.025514353
## 5041.1yr.F -4.7617047  0.28520072  0.060756551
## 5041.2w.F   3.1646155  2.42901236 -1.216761595
## 5041.8w.F   1.0838533 -2.57296922 -0.236134615
## 5045.1yr.F -4.7419263  0.16694129  0.005568155
## 5045.2w.F   1.5045514  3.11037881 -0.462668248
## 5045.8w.F   1.4782189 -2.16474462 -0.450092185
## 5053.1yr.F -4.8160856  0.39888230 -0.016335985
## 5053.2w.F   3.2925437  2.29778435  0.813017161
## 5053.8w.F   0.8843018 -2.10763164  0.478069543</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="free-space.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">x=</span>BCxyz[,<span class="dv">1</span>], </span>
<span id="cb76-2"><a href="free-space.html#cb76-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span>BCxyz[,<span class="dv">2</span>], </span>
<span id="cb76-3"><a href="free-space.html#cb76-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">z=</span>BCxyz[,<span class="dv">3</span>], </span>
<span id="cb76-4"><a href="free-space.html#cb76-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;scatter3d&quot;</span>, </span>
<span id="cb76-5"><a href="free-space.html#cb76-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode =</span> <span class="st">&quot;markers&quot;</span>, </span>
<span id="cb76-6"><a href="free-space.html#cb76-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb76-7"><a href="free-space.html#cb76-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<div id="htmlwidget-62c7785809aa8ca168b9" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-62c7785809aa8ca168b9">{"x":{"visdat":{"43e02e0dc1c":["function () ","plotlyVisDat"]},"cur_data":"43e02e0dc1c","attrs":{"43e02e0dc1c":{"x":[-4.78771931045918,3.18476268753522,1.0503489366724,-4.74665091020587,3.49563969661543,1.5785762791915,-4.76170206868453,3.3964194861303,3.14750317496417,-4.79200712801778,3.35076724688771,0.851676644654691,-4.84180751419167,3.65703934402551,3.12878532308213,-4.7617047247967,3.16461553839772,1.08385331368147,-4.74192629193479,1.50455144673167,1.47821890162157,-4.81608558041068,3.29254366873902,0.884301839770668],"y":[0.328785594747687,0.0569784618449109,-2.11932201408607,0.244791431449645,-1.01621363550618,-1.92688898639618,0.209613326155857,1.09611958519415,2.07012740888467,0.441538083640638,0.480921333582907,-1.63544388612034,0.487460593750542,0.262990349033227,-0.824311993082458,0.285200716116999,2.42901235588814,-2.57296922090692,0.166941287510249,3.11037881450245,-2.16474462015601,0.398882303388391,2.29778435322892,-2.10763164266522],"z":[-0.20457952327386,1.48432574336691,-1.21710078253216,-0.00192747251577329,1.00843978284518,0.465285369061843,0.209854984407134,-0.615338225488531,1.47707047625416,0.196685522708958,-1.49138223669158,0.254264412164606,-0.00431370321553942,-0.511188777772036,-0.025514352591185,0.0607565513943446,-1.21676159479184,-0.236134614700232,0.00556815486584552,-0.462668247727121,-0.450092185135792,-0.0163359845319067,0.813017160751732,0.478069543146837],"mode":"markers","color":["1yr","2w","8w","1yr","2w","8w","1yr","2w","8w","1yr","2w","8w","1yr","2w","8w","1yr","2w","8w","1yr","2w","8w","1yr","2w","8w"],"colors":["blue","green","red"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":[]},"yaxis":{"title":[]},"zaxis":{"title":[]}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-4.78771931045918,-4.74665091020587,-4.76170206868453,-4.79200712801778,-4.84180751419167,-4.7617047247967,-4.74192629193479,-4.81608558041068],"y":[0.328785594747687,0.244791431449645,0.209613326155857,0.441538083640638,0.487460593750542,0.285200716116999,0.166941287510249,0.398882303388391],"z":[-0.20457952327386,-0.00192747251577329,0.209854984407134,0.196685522708958,-0.00431370321553942,0.0607565513943446,0.00556815486584552,-0.0163359845319067],"mode":"markers","type":"scatter3d","name":"1yr","marker":{"color":"rgba(0,0,255,1)","line":{"color":"rgba(0,0,255,1)"}},"textfont":{"color":"rgba(0,0,255,1)"},"error_y":{"color":"rgba(0,0,255,1)"},"error_x":{"color":"rgba(0,0,255,1)"},"line":{"color":"rgba(0,0,255,1)"},"frame":null},{"x":[3.18476268753522,3.49563969661543,3.3964194861303,3.35076724688771,3.65703934402551,3.16461553839772,1.50455144673167,3.29254366873902],"y":[0.0569784618449109,-1.01621363550618,1.09611958519415,0.480921333582907,0.262990349033227,2.42901235588814,3.11037881450245,2.29778435322892],"z":[1.48432574336691,1.00843978284518,-0.615338225488531,-1.49138223669158,-0.511188777772036,-1.21676159479184,-0.462668247727121,0.813017160751732],"mode":"markers","type":"scatter3d","name":"2w","marker":{"color":"rgba(0,255,0,1)","line":{"color":"rgba(0,255,0,1)"}},"textfont":{"color":"rgba(0,255,0,1)"},"error_y":{"color":"rgba(0,255,0,1)"},"error_x":{"color":"rgba(0,255,0,1)"},"line":{"color":"rgba(0,255,0,1)"},"frame":null},{"x":[1.0503489366724,1.5785762791915,3.14750317496417,0.851676644654691,3.12878532308213,1.08385331368147,1.47821890162157,0.884301839770668],"y":[-2.11932201408607,-1.92688898639618,2.07012740888467,-1.63544388612034,-0.824311993082458,-2.57296922090692,-2.16474462015601,-2.10763164266522],"z":[-1.21710078253216,0.465285369061843,1.47707047625416,0.254264412164606,-0.025514352591185,-0.236134614700232,-0.450092185135792,0.478069543146837],"mode":"markers","type":"scatter3d","name":"8w","marker":{"color":"rgba(255,0,0,1)","line":{"color":"rgba(255,0,0,1)"}},"textfont":{"color":"rgba(255,0,0,1)"},"error_y":{"color":"rgba(255,0,0,1)"},"error_x":{"color":"rgba(255,0,0,1)"},"line":{"color":"rgba(255,0,0,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p><br>
3D plots are difficult to interpret in articles, so many authors choose to create two 2D plots instead.
<br></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="free-space.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb77-2"><a href="free-space.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting axis 1 and 2, which are x and y</span></span>
<span id="cb77-3"><a href="free-space.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BCxyz[,<span class="dv">1</span>], </span>
<span id="cb77-4"><a href="free-space.html#cb77-4" aria-hidden="true" tabindex="-1"></a>     BCxyz[,<span class="dv">2</span>], </span>
<span id="cb77-5"><a href="free-space.html#cb77-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Bray-Curtis 1:2&quot;</span>, </span>
<span id="cb77-6"><a href="free-space.html#cb77-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb77-7"><a href="free-space.html#cb77-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup]</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="free-space.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="fl">5.4</span>, <span class="dv">3</span>, </span>
<span id="cb79-2"><a href="free-space.html#cb79-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb79-3"><a href="free-space.html#cb79-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb79-4"><a href="free-space.html#cb79-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb79-5"><a href="free-space.html#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting axis 1 and 3, which are x and z</span></span>
<span id="cb79-6"><a href="free-space.html#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BCxyz[,<span class="dv">1</span>], </span>
<span id="cb79-7"><a href="free-space.html#cb79-7" aria-hidden="true" tabindex="-1"></a>     BCxyz[,<span class="dv">3</span>], </span>
<span id="cb79-8"><a href="free-space.html#cb79-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Bray-Curtis 1:3&quot;</span>, </span>
<span id="cb79-9"><a href="free-space.html#cb79-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb79-10"><a href="free-space.html#cb79-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup]</span></code></pre></div>
<p><img src="_main_files/figure-html/two%202D%20plots-1.png" width="672" /></p>
<pre><code>## NULL</code></pre>
<p><br>
The most common type of beta-diversity metric is UniFrac. This metric takes phylogenetic relationships into account, as opposed to Bray-Curtis and Jaccard. So, with UniFrac, samples with different OTU’s from the same genus will be more similar than samples with OTU’s from different genera. The drawback of UniFrac is that it’s sensitive to low abundance OTU’s.
<br>
To plot UniFrac, we first have to make a phyloseq object. That means we need OTU.clean, meta and tax.clean data. After we’ve created the three separate objects, we’ll merge them into one.
<br></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="free-space.html#cb81-1" aria-hidden="true" tabindex="-1"></a>OTU.UF <span class="ot">=</span> <span class="fu">otu_table</span>(<span class="fu">as.matrix</span>(OTU.clean), <span class="at">taxa_are_rows =</span> <span class="cn">FALSE</span>)</span>
<span id="cb81-2"><a href="free-space.html#cb81-2" aria-hidden="true" tabindex="-1"></a>tax.UF <span class="ot">=</span> <span class="fu">tax_table</span>(<span class="fu">as.matrix</span>(tax.clean))</span>
<span id="cb81-3"><a href="free-space.html#cb81-3" aria-hidden="true" tabindex="-1"></a>meta.UF <span class="ot">=</span> <span class="fu">sample_data</span>(meta)</span>
<span id="cb81-4"><a href="free-space.html#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging them into an object of class phyloseq</span></span>
<span id="cb81-5"><a href="free-space.html#cb81-5" aria-hidden="true" tabindex="-1"></a>physeq <span class="ot">=</span> <span class="fu">phyloseq</span>(OTU.UF, tax.UF, meta.UF)</span></code></pre></div>
<p><br>
To add the phylogenetic component to UniFrac, we need a rooted phylogenetic tree of the OTU’s. In this workshop, it had already been calculated and stored in the dataset ‘NJ.tree.Rdata’. So, we’ll load this data and add it to the physeq object. Then, we’ll look at the tree and its components.
<br></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="free-space.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;Data/Data_raw/NJ.tree.Rdata&quot;</span>) <span class="co"># Downloaded it from GitHub and stored it in the folder &quot;Data_raw&quot;</span></span>
<span id="cb82-2"><a href="free-space.html#cb82-2" aria-hidden="true" tabindex="-1"></a>physeq.tree <span class="ot">=</span> <span class="fu">merge_phyloseq</span>(physeq, NJ.tree)</span>
<span id="cb82-3"><a href="free-space.html#cb82-3" aria-hidden="true" tabindex="-1"></a>physeq.tree</span></code></pre></div>
<pre><code>## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 5002 taxa and 24 samples ]
## sample_data() Sample Data:       [ 24 samples by 9 sample variables ]
## tax_table()   Taxonomy Table:    [ 5002 taxa by 7 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 5002 tips and 5000 internal nodes ]</code></pre>
<p><br>
Next, we’ll calculate the <em>weighted</em> UniFrac and ordinate it into nMDS.
<br></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="free-space.html#cb84-1" aria-hidden="true" tabindex="-1"></a>wUF.ordu <span class="ot">=</span> <span class="fu">ordinate</span>(physeq.tree, </span>
<span id="cb84-2"><a href="free-space.html#cb84-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">&quot;NMDS&quot;</span>, </span>
<span id="cb84-3"><a href="free-space.html#cb84-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">distance =</span> <span class="st">&quot;unifrac&quot;</span>, </span>
<span id="cb84-4"><a href="free-space.html#cb84-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">weighted =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Run 0 stress 0.08645307 
## Run 1 stress 0.08645305 
## ... New best solution
## ... Procrustes: rmse 1.95726e-05  max resid 5.360447e-05 
## ... Similar to previous best
## Run 2 stress 0.1335688 
## Run 3 stress 0.1462923 
## Run 4 stress 0.08645302 
## ... New best solution
## ... Procrustes: rmse 0.0003084251  max resid 0.0008232998 
## ... Similar to previous best
## Run 5 stress 0.08645296 
## ... New best solution
## ... Procrustes: rmse 0.0002326256  max resid 0.0006198192 
## ... Similar to previous best
## Run 6 stress 0.1157451 
## Run 7 stress 0.1143564 
## Run 8 stress 0.1317675 
## Run 9 stress 0.08645297 
## ... Procrustes: rmse 0.0001396108  max resid 0.0003650213 
## ... Similar to previous best
## Run 10 stress 0.08808604 
## Run 11 stress 0.08645293 
## ... New best solution
## ... Procrustes: rmse 5.607187e-05  max resid 0.000148279 
## ... Similar to previous best
## Run 12 stress 0.115745 
## Run 13 stress 0.08645302 
## ... Procrustes: rmse 0.0001812108  max resid 0.00048756 
## ... Similar to previous best
## Run 14 stress 0.1143564 
## Run 15 stress 0.08659154 
## ... Procrustes: rmse 0.004236648  max resid 0.01797805 
## Run 16 stress 0.1295293 
## Run 17 stress 0.08645307 
## ... Procrustes: rmse 0.0001978456  max resid 0.0005319125 
## ... Similar to previous best
## Run 18 stress 0.1347949 
## Run 19 stress 0.08645294 
## ... Procrustes: rmse 1.302835e-05  max resid 3.061646e-05 
## ... Similar to previous best
## Run 20 stress 0.08808611 
## *** Solution reached</code></pre>
<p><br>
Let’s plot the weighted UniFrac nMDS.
<br></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="free-space.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb86-2"><a href="free-space.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wUF.ordu, </span>
<span id="cb86-3"><a href="free-space.html#cb86-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb86-4"><a href="free-space.html#cb86-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Weighted UniFrac&quot;</span>)</span>
<span id="cb86-5"><a href="free-space.html#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(wUF.ordu, </span>
<span id="cb86-6"><a href="free-space.html#cb86-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb86-7"><a href="free-space.html#cb86-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb86-8"><a href="free-space.html#cb86-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup]</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="free-space.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.3</span>, <span class="fl">0.15</span>, </span>
<span id="cb88-2"><a href="free-space.html#cb88-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb88-3"><a href="free-space.html#cb88-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb88-4"><a href="free-space.html#cb88-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20wUF%20nMDS-1.png" width="672" />
<br>
We can also plot it with ggplot2.
<br></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="free-space.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ordination</span>(physeq.tree, </span>
<span id="cb89-2"><a href="free-space.html#cb89-2" aria-hidden="true" tabindex="-1"></a>                wUF.ordu, </span>
<span id="cb89-3"><a href="free-space.html#cb89-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb89-4"><a href="free-space.html#cb89-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;AgeGroup&quot;</span>)<span class="sc">+</span></span>
<span id="cb89-5"><a href="free-space.html#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span><span class="ot">=</span><span class="st">&quot;green&quot;</span>, <span class="st">&quot;8w&quot;</span><span class="ot">=</span><span class="st">&quot;red&quot;</span>, <span class="st">&quot;1yr&quot;</span><span class="ot">=</span><span class="st">&quot;blue&quot;</span>))<span class="sc">+</span></span>
<span id="cb89-6"><a href="free-space.html#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb89-7"><a href="free-space.html#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Weighted UniFrac&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-10-1.png" width="672" />
<br>
The Unweighted UniFrac can also be calculated and plotted.
<br></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="free-space.html#cb90-1" aria-hidden="true" tabindex="-1"></a>uwUF.ordu <span class="ot">=</span> <span class="fu">ordinate</span>(physeq.tree, </span>
<span id="cb90-2"><a href="free-space.html#cb90-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&quot;NMDS&quot;</span>, </span>
<span id="cb90-3"><a href="free-space.html#cb90-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">distance =</span> <span class="st">&quot;unifrac&quot;</span>, </span>
<span id="cb90-4"><a href="free-space.html#cb90-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">weighted =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Run 0 stress 9.695153e-05 
## Run 1 stress 9.657832e-05 
## ... New best solution
## ... Procrustes: rmse 7.750783e-05  max resid 0.0002776914 
## ... Similar to previous best
## Run 2 stress 9.871795e-05 
## ... Procrustes: rmse 8.086551e-05  max resid 0.0002819207 
## ... Similar to previous best
## Run 3 stress 9.488623e-05 
## ... New best solution
## ... Procrustes: rmse 7.261501e-05  max resid 0.0002642816 
## ... Similar to previous best
## Run 4 stress 9.862006e-05 
## ... Procrustes: rmse 1.701217e-05  max resid 5.025527e-05 
## ... Similar to previous best
## Run 5 stress 9.806631e-05 
## ... Procrustes: rmse 0.0001070473  max resid 0.0002353732 
## ... Similar to previous best
## Run 6 stress 9.757454e-05 
## ... Procrustes: rmse 3.985665e-05  max resid 0.0001388531 
## ... Similar to previous best
## Run 7 stress 9.826177e-05 
## ... Procrustes: rmse 9.722135e-05  max resid 0.0002191936 
## ... Similar to previous best
## Run 8 stress 9.695708e-05 
## ... Procrustes: rmse 7.448687e-05  max resid 0.0002751687 
## ... Similar to previous best
## Run 9 stress 9.907648e-05 
## ... Procrustes: rmse 9.310993e-05  max resid 0.0002388289 
## ... Similar to previous best
## Run 10 stress 9.984534e-05 
## ... Procrustes: rmse 3.384419e-05  max resid 0.0001260377 
## ... Similar to previous best
## Run 11 stress 9.684607e-05 
## ... Procrustes: rmse 0.0001319037  max resid 0.0003356478 
## ... Similar to previous best
## Run 12 stress 9.69891e-05 
## ... Procrustes: rmse 8.404145e-06  max resid 2.447679e-05 
## ... Similar to previous best
## Run 13 stress 0.0002969569 
## ... Procrustes: rmse 0.0003866364  max resid 0.0006715474 
## ... Similar to previous best
## Run 14 stress 9.723199e-05 
## ... Procrustes: rmse 3.731826e-05  max resid 0.0001336343 
## ... Similar to previous best
## Run 15 stress 9.99257e-05 
## ... Procrustes: rmse 0.0001270356  max resid 0.0003614341 
## ... Similar to previous best
## Run 16 stress 9.955355e-05 
## ... Procrustes: rmse 6.056256e-05  max resid 0.0001673759 
## ... Similar to previous best
## Run 17 stress 9.589429e-05 
## ... Procrustes: rmse 1.686683e-05  max resid 4.596185e-05 
## ... Similar to previous best
## Run 18 stress 9.633493e-05 
## ... Procrustes: rmse 3.660483e-05  max resid 0.0001324208 
## ... Similar to previous best
## Run 19 stress 9.921893e-05 
## ... Procrustes: rmse 1.085938e-05  max resid 1.669484e-05 
## ... Similar to previous best
## Run 20 stress 9.637055e-05 
## ... Procrustes: rmse 6.450683e-05  max resid 0.0001970587 
## ... Similar to previous best
## *** Solution reached</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="free-space.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ordination</span>(physeq.tree, </span>
<span id="cb92-2"><a href="free-space.html#cb92-2" aria-hidden="true" tabindex="-1"></a>                uwUF.ordu, </span>
<span id="cb92-3"><a href="free-space.html#cb92-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb92-4"><a href="free-space.html#cb92-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;AgeGroup&quot;</span>)<span class="sc">+</span></span>
<span id="cb92-5"><a href="free-space.html#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span> <span class="ot">=</span> <span class="st">&quot;green&quot;</span>, <span class="st">&quot;8w&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, <span class="st">&quot;1yr&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>))<span class="sc">+</span></span>
<span id="cb92-6"><a href="free-space.html#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb92-7"><a href="free-space.html#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Unweighted UniFrac&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/uwUF%20nMDS-1.png" width="672" />
<br>
We can also plot the ellipses of the Weighted UniFrac distances.
<br></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="free-space.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wUF.ordu, </span>
<span id="cb93-2"><a href="free-space.html#cb93-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb93-3"><a href="free-space.html#cb93-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Weighted UniFrac&quot;</span>)</span>
<span id="cb93-4"><a href="free-space.html#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.3</span>, <span class="fl">0.15</span>, </span>
<span id="cb93-5"><a href="free-space.html#cb93-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>,<span class="st">&quot;8w&quot;</span>,<span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb93-6"><a href="free-space.html#cb93-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb93-7"><a href="free-space.html#cb93-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb93-8"><a href="free-space.html#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ellipse for 2 weeks</span></span>
<span id="cb93-9"><a href="free-space.html#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiellipse</span>(wUF.ordu, </span>
<span id="cb93-10"><a href="free-space.html#cb93-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">groups =</span> meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb93-11"><a href="free-space.html#cb93-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb93-12"><a href="free-space.html#cb93-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">kind =</span> <span class="st">&quot;se&quot;</span>, </span>
<span id="cb93-13"><a href="free-space.html#cb93-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">conf =</span> <span class="fl">0.99</span>, </span>
<span id="cb93-14"><a href="free-space.html#cb93-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="cn">FALSE</span>, </span>
<span id="cb93-15"><a href="free-space.html#cb93-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, </span>
<span id="cb93-16"><a href="free-space.html#cb93-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">draw =</span> <span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb93-17"><a href="free-space.html#cb93-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">200</span>, </span>
<span id="cb93-18"><a href="free-space.html#cb93-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.groups =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>), </span>
<span id="cb93-19"><a href="free-space.html#cb93-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">border =</span> <span class="cn">FALSE</span>)</span>
<span id="cb93-20"><a href="free-space.html#cb93-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Ellipse for 8 weeks</span></span>
<span id="cb93-21"><a href="free-space.html#cb93-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiellipse</span>(wUF.ordu, </span>
<span id="cb93-22"><a href="free-space.html#cb93-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">groups =</span> meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb93-23"><a href="free-space.html#cb93-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb93-24"><a href="free-space.html#cb93-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">kind =</span> <span class="st">&quot;se&quot;</span>, </span>
<span id="cb93-25"><a href="free-space.html#cb93-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">conf =</span> <span class="fl">0.99</span>, </span>
<span id="cb93-26"><a href="free-space.html#cb93-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="cn">FALSE</span>, </span>
<span id="cb93-27"><a href="free-space.html#cb93-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb93-28"><a href="free-space.html#cb93-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">draw =</span> <span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb93-29"><a href="free-space.html#cb93-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">200</span>, </span>
<span id="cb93-30"><a href="free-space.html#cb93-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.groups =</span> <span class="fu">c</span>(<span class="st">&quot;8w&quot;</span>), </span>
<span id="cb93-31"><a href="free-space.html#cb93-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">border =</span> <span class="cn">FALSE</span>)</span>
<span id="cb93-32"><a href="free-space.html#cb93-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Ellipse for 1 year</span></span>
<span id="cb93-33"><a href="free-space.html#cb93-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiellipse</span>(wUF.ordu, </span>
<span id="cb93-34"><a href="free-space.html#cb93-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">groups =</span> meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb93-35"><a href="free-space.html#cb93-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb93-36"><a href="free-space.html#cb93-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">kind =</span> <span class="st">&quot;se&quot;</span>, </span>
<span id="cb93-37"><a href="free-space.html#cb93-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">conf =</span> <span class="fl">0.99</span>, </span>
<span id="cb93-38"><a href="free-space.html#cb93-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="cn">FALSE</span>, </span>
<span id="cb93-39"><a href="free-space.html#cb93-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb93-40"><a href="free-space.html#cb93-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">draw =</span> <span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb93-41"><a href="free-space.html#cb93-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">200</span>, </span>
<span id="cb93-42"><a href="free-space.html#cb93-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.groups =</span> <span class="fu">c</span>(<span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb93-43"><a href="free-space.html#cb93-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">border =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-11-1.png" width="672" />
<br>
Ellipses can also be plotted with ggplot2, although they look a bit different.
<br></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="free-space.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ordination</span>(physeq.tree, </span>
<span id="cb94-2"><a href="free-space.html#cb94-2" aria-hidden="true" tabindex="-1"></a>                wUF.ordu, </span>
<span id="cb94-3"><a href="free-space.html#cb94-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb94-4"><a href="free-space.html#cb94-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;AgeGroup&quot;</span>)<span class="sc">+</span></span>
<span id="cb94-5"><a href="free-space.html#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span> <span class="ot">=</span> <span class="st">&quot;green&quot;</span>, <span class="st">&quot;8w&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, <span class="st">&quot;1yr&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>))<span class="sc">+</span></span>
<span id="cb94-6"><a href="free-space.html#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb94-7"><a href="free-space.html#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>()<span class="sc">+</span></span>
<span id="cb94-8"><a href="free-space.html#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Weighted UniFrac&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="672" />
<br>
We can calculate UniFrac distances with <em>UniFrac</em> and ordinate it for 3-axes with <em>metaMDS</em>.
<br></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="free-space.html#cb95-1" aria-hidden="true" tabindex="-1"></a>wUF.dist <span class="ot">=</span> <span class="fu">UniFrac</span>(physeq.tree, <span class="at">weighted =</span> <span class="cn">TRUE</span>, <span class="at">normalized =</span> <span class="cn">TRUE</span>)</span>
<span id="cb95-2"><a href="free-space.html#cb95-2" aria-hidden="true" tabindex="-1"></a>wUF.nmds<span class="fl">.3</span>D <span class="ot">=</span> <span class="fu">metaMDS</span>(wUF.dist, <span class="at">method =</span> <span class="st">&quot;NMDS&quot;</span>, <span class="at">k=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Run 0 stress 0.04217394 
## Run 1 stress 0.05952403 
## Run 2 stress 0.05952413 
## Run 3 stress 0.04217396 
## ... Procrustes: rmse 4.597236e-05  max resid 0.0001189685 
## ... Similar to previous best
## Run 4 stress 0.04217403 
## ... Procrustes: rmse 0.0001487937  max resid 0.0004561402 
## ... Similar to previous best
## Run 5 stress 0.04217395 
## ... Procrustes: rmse 6.845306e-05  max resid 0.0002343482 
## ... Similar to previous best
## Run 6 stress 0.05952413 
## Run 7 stress 0.042174 
## ... Procrustes: rmse 0.0001351877  max resid 0.0004443447 
## ... Similar to previous best
## Run 8 stress 0.06761596 
## Run 9 stress 0.059524 
## Run 10 stress 0.04217407 
## ... Procrustes: rmse 0.0001709586  max resid 0.0005650254 
## ... Similar to previous best
## Run 11 stress 0.04217396 
## ... Procrustes: rmse 9.078681e-05  max resid 0.0003021391 
## ... Similar to previous best
## Run 12 stress 0.04217405 
## ... Procrustes: rmse 0.000168228  max resid 0.0005161761 
## ... Similar to previous best
## Run 13 stress 0.04217398 
## ... Procrustes: rmse 0.0001098377  max resid 0.0003567109 
## ... Similar to previous best
## Run 14 stress 0.042174 
## ... Procrustes: rmse 8.346652e-05  max resid 0.0002407597 
## ... Similar to previous best
## Run 15 stress 0.04217407 
## ... Procrustes: rmse 0.0001837054  max resid 0.0006272833 
## ... Similar to previous best
## Run 16 stress 0.04217406 
## ... Procrustes: rmse 0.0001481673  max resid 0.0003732481 
## ... Similar to previous best
## Run 17 stress 0.04217395 
## ... Procrustes: rmse 2.316957e-05  max resid 7.009862e-05 
## ... Similar to previous best
## Run 18 stress 0.04217396 
## ... Procrustes: rmse 8.182881e-05  max resid 0.0002803632 
## ... Similar to previous best
## Run 19 stress 0.04217397 
## ... Procrustes: rmse 0.0001031614  max resid 0.0003380335 
## ... Similar to previous best
## Run 20 stress 0.04217399 
## ... Procrustes: rmse 0.0001082464  max resid 0.0003554024 
## ... Similar to previous best
## *** Solution reached</code></pre>
<p><br>
Then, we’ll take out the xyz values and plot them with plotly.
<br></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="free-space.html#cb97-1" aria-hidden="true" tabindex="-1"></a>wUFxyz <span class="ot">=</span> <span class="fu">scores</span>(wUF.nmds<span class="fl">.3</span>D, <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb97-2"><a href="free-space.html#cb97-2" aria-hidden="true" tabindex="-1"></a>wUFxyz</span></code></pre></div>
<pre><code>##                  NMDS1        NMDS2       NMDS3
## 5017.1yr.F -0.19592858  0.107838852  0.07970378
## 5017.2w.F   0.40344380  0.187070009 -0.11910580
## 5017.8w.F  -0.06745447  0.045811253 -0.21943422
## 5020.1yr.F -0.21314445  0.100936809  0.06830615
## 5020.2w.F  -0.02919525 -0.163696093 -0.02924315
## 5020.8w.F   0.03370365  0.054488455 -0.09105410
## 5026.1yr.F -0.22486455  0.066643683  0.05598675
## 5026.2w.F   0.13248515 -0.217106790  0.08751753
## 5026.8w.F   0.39018092  0.135420606  0.24011653
## 5031.1yr.F -0.19998566  0.080482377  0.09446961
## 5031.2w.F   0.19092361 -0.256894303  0.01561278
## 5031.8w.F  -0.13588109 -0.042296559 -0.02585488
## 5037.1yr.F -0.21803783  0.076509564  0.07189351
## 5037.2w.F   0.05189732 -0.120255191 -0.04231306
## 5037.8w.F   0.14232875 -0.115637316 -0.01896293
## 5041.1yr.F -0.20914084  0.081785024  0.07442644
## 5041.2w.F   0.27828678 -0.237773303  0.03642365
## 5041.8w.F  -0.13941945 -0.001654062 -0.18656492
## 5045.1yr.F -0.23334457  0.051075686  0.06283287
## 5045.2w.F   0.49235803  0.294995885 -0.14636092
## 5045.8w.F  -0.16920077 -0.126231476 -0.13821994
## 5053.1yr.F -0.21544102  0.077998233  0.08008381
## 5053.2w.F   0.27521892 -0.030406547  0.17560574
## 5053.8w.F  -0.13978837 -0.049104795 -0.12586523</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="free-space.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">x=</span>wUFxyz[,<span class="dv">1</span>], </span>
<span id="cb99-2"><a href="free-space.html#cb99-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span>wUFxyz[,<span class="dv">2</span>], </span>
<span id="cb99-3"><a href="free-space.html#cb99-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">z=</span>wUFxyz[,<span class="dv">3</span>], </span>
<span id="cb99-4"><a href="free-space.html#cb99-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;scatter3d&quot;</span>, </span>
<span id="cb99-5"><a href="free-space.html#cb99-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode =</span> <span class="st">&quot;markers&quot;</span>, </span>
<span id="cb99-6"><a href="free-space.html#cb99-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">color=</span>meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb99-7"><a href="free-space.html#cb99-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">colors=</span><span class="fu">c</span>(<span class="st">&quot;pink&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<div id="htmlwidget-08bbfcaa24223a5a3d2e" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-08bbfcaa24223a5a3d2e">{"x":{"visdat":{"43e031876a77":["function () ","plotlyVisDat"]},"cur_data":"43e031876a77","attrs":{"43e031876a77":{"x":[-0.19592858103205,0.403443797563631,-0.0674544709789275,-0.213144451318145,-0.029195251142192,0.0337036476920514,-0.224864548726631,0.13248515031895,0.390180917453704,-0.199985662213819,0.19092360734092,-0.13588108508355,-0.218037833728084,0.0518973226399105,0.142328745315163,-0.209140843377632,0.278286780267357,-0.13941944770309,-0.233344570264657,0.492358029925642,-0.169200774321509,-0.215441022562339,0.275218917623397,-0.139788373688101],"y":[0.107838852075638,0.187070009456276,0.0458112527156279,0.100936809207075,-0.163696093319003,0.054488454641568,0.0666436833094421,-0.21710679003518,0.135420605612063,0.0804823765932766,-0.256894303187102,-0.0422965588763816,0.0765095643668562,-0.120255190806781,-0.115637315704089,0.0817850238802328,-0.237773303065919,-0.00165406171854154,0.0510756855539885,0.294995884862548,-0.126231476360129,0.0779982325981863,-0.0304065472094594,-0.0491047945901905],"z":[0.079703776382978,-0.119105795157837,-0.219434218619414,0.0683061522202025,-0.0292431472330305,-0.0910541037239572,0.0559867499766846,0.0875175263883615,0.240116530104297,0.0944696143126626,0.0156127809565279,-0.025854879777142,0.0718935050607912,-0.0423130552214619,-0.0189629299429066,0.0744264359156381,0.0364236489121322,-0.186564923991024,0.0628328700475962,-0.14636091981074,-0.138219938722338,0.0800838092542755,0.175605741577039,-0.125865228909335],"mode":"markers","color":["1yr","2w","8w","1yr","2w","8w","1yr","2w","8w","1yr","2w","8w","1yr","2w","8w","1yr","2w","8w","1yr","2w","8w","1yr","2w","8w"],"colors":["pink","purple","blue"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":[]},"yaxis":{"title":[]},"zaxis":{"title":[]}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-0.19592858103205,-0.213144451318145,-0.224864548726631,-0.199985662213819,-0.218037833728084,-0.209140843377632,-0.233344570264657,-0.215441022562339],"y":[0.107838852075638,0.100936809207075,0.0666436833094421,0.0804823765932766,0.0765095643668562,0.0817850238802328,0.0510756855539885,0.0779982325981863],"z":[0.079703776382978,0.0683061522202025,0.0559867499766846,0.0944696143126626,0.0718935050607912,0.0744264359156381,0.0628328700475962,0.0800838092542755],"mode":"markers","type":"scatter3d","name":"1yr","marker":{"color":"rgba(255,192,203,1)","line":{"color":"rgba(255,192,203,1)"}},"textfont":{"color":"rgba(255,192,203,1)"},"error_y":{"color":"rgba(255,192,203,1)"},"error_x":{"color":"rgba(255,192,203,1)"},"line":{"color":"rgba(255,192,203,1)"},"frame":null},{"x":[0.403443797563631,-0.029195251142192,0.13248515031895,0.19092360734092,0.0518973226399105,0.278286780267357,0.492358029925642,0.275218917623397],"y":[0.187070009456276,-0.163696093319003,-0.21710679003518,-0.256894303187102,-0.120255190806781,-0.237773303065919,0.294995884862548,-0.0304065472094594],"z":[-0.119105795157837,-0.0292431472330305,0.0875175263883615,0.0156127809565279,-0.0423130552214619,0.0364236489121322,-0.14636091981074,0.175605741577039],"mode":"markers","type":"scatter3d","name":"2w","marker":{"color":"rgba(160,32,240,1)","line":{"color":"rgba(160,32,240,1)"}},"textfont":{"color":"rgba(160,32,240,1)"},"error_y":{"color":"rgba(160,32,240,1)"},"error_x":{"color":"rgba(160,32,240,1)"},"line":{"color":"rgba(160,32,240,1)"},"frame":null},{"x":[-0.0674544709789275,0.0337036476920514,0.390180917453704,-0.13588108508355,0.142328745315163,-0.13941944770309,-0.169200774321509,-0.139788373688101],"y":[0.0458112527156279,0.054488454641568,0.135420605612063,-0.0422965588763816,-0.115637315704089,-0.00165406171854154,-0.126231476360129,-0.0491047945901905],"z":[-0.219434218619414,-0.0910541037239572,0.240116530104297,-0.025854879777142,-0.0189629299429066,-0.186564923991024,-0.138219938722338,-0.125865228909335],"mode":"markers","type":"scatter3d","name":"8w","marker":{"color":"rgba(0,0,255,1)","line":{"color":"rgba(0,0,255,1)"}},"textfont":{"color":"rgba(0,0,255,1)"},"error_y":{"color":"rgba(0,0,255,1)"},"error_x":{"color":"rgba(0,0,255,1)"},"line":{"color":"rgba(0,0,255,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p><br>
<br>
It is harder to visualize continuous variables in the way we’ve just visualized categorical values. We can, however, fit these as vectors on the nMDS plots.
<br>
To do that, we’ll first fit the variables to our distances. We’ll use Bray-Curtis and weighted UniFrac for this, but you can do this with Jaccard aswell and you could also use unweighted UniFrac.
<br></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="free-space.html#cb100-1" aria-hidden="true" tabindex="-1"></a>fit.BC <span class="ot">=</span> <span class="fu">envfit</span>(BC.nmds, meta)</span>
<span id="cb100-2"><a href="free-space.html#cb100-2" aria-hidden="true" tabindex="-1"></a>fit.BC</span></code></pre></div>
<pre><code>## 
## ***VECTORS
## 
##             NMDS1    NMDS2     r2 Pr(&gt;r)    
## AgeExact -0.99893 -0.04630 0.9765  0.001 ***
## ADGKG     0.12541  0.99210 0.0771  0.444    
## chao     -0.98550  0.16970 0.9598  0.001 ***
## shannon  -0.69388  0.72009 0.9469  0.001 ***
## simpson   0.42089 -0.90711 0.7353  0.001 ***
## ace      -0.99737  0.07248 0.9078  0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999
## 
## ***FACTORS:
## 
## Centroids:
##                   NMDS1   NMDS2
## Animalcow5017   -0.1827  0.5460
## Animalcow5020    0.0065  0.6579
## Animalcow5026    0.4231 -0.8839
## Animalcow5031   -0.2440  0.1186
## Animalcow5037    0.4943 -0.0574
## Animalcow5041    0.0501 -0.0289
## Animalcow5045   -0.1383 -0.3395
## Animalcow5053   -0.4090 -0.0129
## AgeGroup1yr     -4.4483 -0.1795
## AgeGroup2w       2.5035 -1.0530
## AgeGroup8w       1.9447  1.2325
## AgeGroup.ord2w   2.5035 -1.0530
## AgeGroup.ord8w   1.9447  1.2325
## AgeGroup.ord1yr -4.4483 -0.1795
## 
## Goodness of fit:
##                  r2 Pr(&gt;r)    
## Animal       0.0248  0.997    
## AgeGroup     0.9133  0.001 ***
## AgeGroup.ord 0.9133  0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</code></pre>
<p><br>
R has automatically fit every variable into the meta table.
If we don’t want that, we can tell envfit to only run the variables we want.
<br></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="free-space.html#cb102-1" aria-hidden="true" tabindex="-1"></a>fit.BC <span class="ot">=</span> <span class="fu">envfit</span>(BC.nmds, meta[,<span class="fu">c</span>(<span class="st">&quot;AgeGroup&quot;</span>, <span class="st">&quot;ADGKG&quot;</span>)])</span>
<span id="cb102-2"><a href="free-space.html#cb102-2" aria-hidden="true" tabindex="-1"></a>fit.BC</span></code></pre></div>
<pre><code>## 
## ***VECTORS
## 
##         NMDS1   NMDS2     r2 Pr(&gt;r)
## ADGKG 0.12541 0.99210 0.0771  0.452
## Permutation: free
## Number of permutations: 999
## 
## ***FACTORS:
## 
## Centroids:
##               NMDS1   NMDS2
## AgeGroup1yr -4.4483 -0.1795
## AgeGroup2w   2.5035 -1.0530
## AgeGroup8w   1.9447  1.2325
## 
## Goodness of fit:
##              r2 Pr(&gt;r)    
## AgeGroup 0.9133  0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</code></pre>
<p><br>
We’ll repeat this for the weighted UniFrac.
<br></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="free-space.html#cb104-1" aria-hidden="true" tabindex="-1"></a>fit.wUF <span class="ot">=</span> <span class="fu">envfit</span>(wUF.ordu, meta[,<span class="fu">c</span>(<span class="st">&quot;AgeGroup&quot;</span>, <span class="st">&quot;ADGKG&quot;</span>)])</span>
<span id="cb104-2"><a href="free-space.html#cb104-2" aria-hidden="true" tabindex="-1"></a>fit.wUF</span></code></pre></div>
<pre><code>## 
## ***VECTORS
## 
##          NMDS1    NMDS2     r2 Pr(&gt;r)
## ADGKG -0.17839  0.98396 0.0399   0.66
## Permutation: free
## Number of permutations: 999
## 
## ***FACTORS:
## 
## Centroids:
##               NMDS1   NMDS2
## AgeGroup1yr -0.1076 -0.0833
## AgeGroup2w   0.1432  0.0322
## AgeGroup8w  -0.0356  0.0512
## 
## Goodness of fit:
##              r2 Pr(&gt;r)    
## AgeGroup 0.5588  0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</code></pre>
<p><br>
We can plot the 2D nMDS with an arrow for the ADG, eventho the ADG isn’t a significant variable. Thus, you wouldn’t use this figure in a publication or such. We’ll do this with the Bray-Curtis dissimilarity.
<br></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="free-space.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BC.nmds, </span>
<span id="cb106-2"><a href="free-space.html#cb106-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb106-3"><a href="free-space.html#cb106-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Bray-Curtis&quot;</span>)</span>
<span id="cb106-4"><a href="free-space.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(BC.nmds, </span>
<span id="cb106-5"><a href="free-space.html#cb106-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb106-6"><a href="free-space.html#cb106-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb106-7"><a href="free-space.html#cb106-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup]</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="free-space.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">2</span>, </span>
<span id="cb108-2"><a href="free-space.html#cb108-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb108-3"><a href="free-space.html#cb108-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb108-4"><a href="free-space.html#cb108-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb108-5"><a href="free-space.html#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.BC, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>) <span class="co"># Adding the fitted variables</span></span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20the%20fitted%20BC-1.png" width="672" />
<br>
We can also only plot variables with p &lt; 0.05. That’d mean we’d only see the centroids.
<br></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="free-space.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BC.nmds, </span>
<span id="cb109-2"><a href="free-space.html#cb109-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb109-3"><a href="free-space.html#cb109-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Bray-Curtis&quot;</span>)</span>
<span id="cb109-4"><a href="free-space.html#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(BC.nmds, </span>
<span id="cb109-5"><a href="free-space.html#cb109-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb109-6"><a href="free-space.html#cb109-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb109-7"><a href="free-space.html#cb109-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup]</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="free-space.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">2</span>, </span>
<span id="cb111-2"><a href="free-space.html#cb111-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb111-3"><a href="free-space.html#cb111-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb111-4"><a href="free-space.html#cb111-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb111-5"><a href="free-space.html#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.BC, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">p.max =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20the%20significant%20BC-1.png" width="672" />
<br>
We can also plot the weighted UniFrac.
<br></p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="free-space.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wUF.ordu, </span>
<span id="cb112-2"><a href="free-space.html#cb112-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb112-3"><a href="free-space.html#cb112-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Weighted UniFrac&quot;</span>)</span>
<span id="cb112-4"><a href="free-space.html#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(wUF.ordu, </span>
<span id="cb112-5"><a href="free-space.html#cb112-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb112-6"><a href="free-space.html#cb112-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb112-7"><a href="free-space.html#cb112-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup]</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="free-space.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(.<span class="dv">3</span>, .<span class="dv">15</span>, </span>
<span id="cb114-2"><a href="free-space.html#cb114-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb114-3"><a href="free-space.html#cb114-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb114-4"><a href="free-space.html#cb114-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb114-5"><a href="free-space.html#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.wUF, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20wUF-1.png" width="672" />
<br>
If we fit the OTU.clean data frame to the nMDS, we can add arrows for specific OTU’s in the plot. <br>
If an OTU arrow goes in the same direction as an age group centroid, that OTU tends to increase in abundance in that age group. <br>
Conversely, if an OTU arrow moves in the opposite direction of an age group centroid, that OTU probably decreases in abundance in that age group. <br>
We’ll only fit the first 10 OTU’s from our table, because it takes a long time. <br>
Then, we’ll only plot the significant arrows.
<br></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="free-space.html#cb115-1" aria-hidden="true" tabindex="-1"></a>fit.BC.OTU <span class="ot">=</span> <span class="fu">envfit</span>(BC.nmds, OTU.clean[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb115-2"><a href="free-space.html#cb115-2" aria-hidden="true" tabindex="-1"></a>fit.BC.OTU</span></code></pre></div>
<pre><code>## 
## ***VECTORS
## 
##             NMDS1    NMDS2     r2 Pr(&gt;r)    
## Otu00001  0.71703 -0.69704 0.2478  0.033 *  
## Otu00002  0.46962 -0.88287 0.2108  0.057 .  
## Otu00003  0.25731 -0.96633 0.2503  0.021 *  
## Otu00004  0.25055  0.96810 0.2740  0.030 *  
## Otu00005  0.15507  0.98790 0.2906  0.003 ** 
## Otu00006 -0.96828  0.24987 0.6742  0.001 ***
## Otu00007  0.18000 -0.98367 0.2487  0.009 ** 
## Otu00008  0.40221  0.91555 0.3108  0.016 *  
## Otu00009  0.26281 -0.96485 0.1893  0.062 .  
## Otu00010  0.33879 -0.94086 0.1552  0.078 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="free-space.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BC.nmds, </span>
<span id="cb117-2"><a href="free-space.html#cb117-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb117-3"><a href="free-space.html#cb117-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Bray-Curtis&quot;</span>)</span>
<span id="cb117-4"><a href="free-space.html#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(BC.nmds, </span>
<span id="cb117-5"><a href="free-space.html#cb117-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb117-6"><a href="free-space.html#cb117-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb117-7"><a href="free-space.html#cb117-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup]</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="free-space.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="sc">-</span><span class="fl">1.1</span>, </span>
<span id="cb119-2"><a href="free-space.html#cb119-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb119-3"><a href="free-space.html#cb119-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb119-4"><a href="free-space.html#cb119-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb119-5"><a href="free-space.html#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.BC.OTU, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">p.max =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/fitting%20OTUs-1.png" width="672" />
<br>
We can also plot summed genera or family groups of OTU’s.
<br></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="free-space.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting all the OTU&#39;s within the Ruminococcus genus</span></span>
<span id="cb120-2"><a href="free-space.html#cb120-2" aria-hidden="true" tabindex="-1"></a>OTU.rumino <span class="ot">=</span> OTU.clean[,tax.clean<span class="sc">$</span>Genus <span class="sc">==</span> <span class="st">&quot;g__Ruminococcus&quot;</span>]</span>
<span id="cb120-3"><a href="free-space.html#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summing the abundances of the OTU&#39;s into one variable/column</span></span>
<span id="cb120-4"><a href="free-space.html#cb120-4" aria-hidden="true" tabindex="-1"></a>OTU.rumino<span class="sc">$</span>Rumino.sum <span class="ot">=</span> <span class="fu">rowSums</span>(OTU.rumino)</span>
<span id="cb120-5"><a href="free-space.html#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting the Ruminococceae group</span></span>
<span id="cb120-6"><a href="free-space.html#cb120-6" aria-hidden="true" tabindex="-1"></a>fit.BC.rumino <span class="ot">=</span> <span class="fu">envfit</span>(BC.nmds, OTU.rumino<span class="sc">$</span>Rumino.sum)</span>
<span id="cb120-7"><a href="free-space.html#cb120-7" aria-hidden="true" tabindex="-1"></a>fit.BC.rumino</span></code></pre></div>
<pre><code>## 
## ***VECTORS
## 
##         NMDS1    NMDS2     r2 Pr(&gt;r)    
## [1,] -0.14496  0.98944 0.6622  0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="free-space.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting it</span></span>
<span id="cb122-2"><a href="free-space.html#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BC.nmds, </span>
<span id="cb122-3"><a href="free-space.html#cb122-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb122-4"><a href="free-space.html#cb122-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Bray-Curtis&quot;</span>)</span>
<span id="cb122-5"><a href="free-space.html#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(BC.nmds, </span>
<span id="cb122-6"><a href="free-space.html#cb122-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb122-7"><a href="free-space.html#cb122-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb122-8"><a href="free-space.html#cb122-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup]</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="free-space.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="sc">-</span><span class="fl">1.1</span>, </span>
<span id="cb124-2"><a href="free-space.html#cb124-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb124-3"><a href="free-space.html#cb124-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb124-4"><a href="free-space.html#cb124-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb124-5"><a href="free-space.html#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the fitted variables</span></span>
<span id="cb124-6"><a href="free-space.html#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.BC.rumino, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Ruminococcus&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20rumino-1.png" width="672" />
<br>
We can test for significant differences between samples with the permutational analysis of variance, PERMANOVA, or analysis of similarity, ANOSIM. Both test if the overall microbial community differs by your variable of interest. <br>
We can run these tests with Bray-Curtis, Jaccard, unweighted UniFrac and/or weighted UniFrac. <br>
If the variable is significant for Bray-Curtis/weighted UniFrac but not for Jaccard/unweighted UniFrac, that means the groups tend to have the same OTU’s(richness), but different abundances of those OTU’s(diversity). <br>
If the variables are significant for Bray-Curtis/Jaccard but not for unweighted/weighted UniFrac, that means the samples have different specific OTU’s but similar taxa. <br>
For Bray-Curtis and Jaccard, we can calculate the distances and run PERMANOVA.
<br></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="free-space.html#cb125-1" aria-hidden="true" tabindex="-1"></a>BC.dist <span class="ot">=</span> <span class="fu">vegdist</span>(OTU.clean, <span class="at">distance =</span> <span class="st">&quot;bray&quot;</span>)</span>
<span id="cb125-2"><a href="free-space.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co"># adonis(BC.dist ~ AgeGroup*ADGKG, data = meta, permutations = 1000)</span></span></code></pre></div>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="free-space.html#cb126-1" aria-hidden="true" tabindex="-1"></a>J.dist <span class="ot">=</span> <span class="fu">vegdist</span>(OTU.clean, <span class="at">distance =</span> <span class="st">&quot;jaccard&quot;</span>)</span>
<span id="cb126-2"><a href="free-space.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co"># adonis(J.dist ~ AgeGroup*ADGKG, data = meta, permutations = 1000)</span></span></code></pre></div>
<p><br>
For both Bray-Curtis and Jaccard, the interaction isn’t significant. So we’ll run PERMANOVA again, without the interaction component.
<br></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="free-space.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adonis(BC.dist ~ AgeGroup+ADGKG, data = meta, permutations = 1000)</span></span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="free-space.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adonis(J.dist ~ AgeGroup+ADGKG, data = meta, permutations = 1000)</span></span></code></pre></div>
<p><br>
We’ll also calculate the distances for weighted and unweighted UniFrac and then run PERMANOVA.
<br></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="free-space.html#cb129-1" aria-hidden="true" tabindex="-1"></a>wUF.dist <span class="ot">=</span> <span class="fu">UniFrac</span>(physeq.tree, <span class="at">weighted =</span> <span class="cn">TRUE</span>, <span class="at">normalized =</span> <span class="cn">TRUE</span>)</span>
<span id="cb129-2"><a href="free-space.html#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="co"># adonis(wUF.dist ~ AgeGroup*ADGKG, data = meta, permutations = 1000)</span></span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="free-space.html#cb130-1" aria-hidden="true" tabindex="-1"></a>uwUF.dist <span class="ot">=</span> <span class="fu">UniFrac</span>(physeq.tree, <span class="at">weighted =</span> <span class="cn">FALSE</span>, <span class="at">normalized =</span> <span class="cn">TRUE</span>)</span>
<span id="cb130-2"><a href="free-space.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># adonis(uwUF.dist ~ AgeGroup*ADGKG, data = meta, permutations = 1000)</span></span></code></pre></div>
<p><br>
We’ll remove the non-significant interaction terms for both of these aswell.
<br></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="free-space.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adonis(wUF.dist ~ AgeGroup+ADGKG, data = meta, permutations = 1000)</span></span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="free-space.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adonis(uwUF.dist ~ AgeGroup+ADGKG, data = meta, permutations = 1000)</span></span></code></pre></div>
<p><br>
If your group sizes are very different, you can use ANOSIM instead of PERMANOVA. ANOSIM does have quite some limitations; you can only test one variable, so no interaction, and it can only be used for categorical variables. <br>
We’ll run it for Bray-Curtis to demonstrate.
<br></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="free-space.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anosim</span>(BC.dist, meta<span class="sc">$</span>AgeGroup, <span class="at">permutations =</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## anosim(x = BC.dist, grouping = meta$AgeGroup, permutations = 1000) 
## Dissimilarity: bray 
## 
## ANOSIM statistic R: 0.8467 
##       Significance: 0.000999 
## 
## Permutation: free
## Number of permutations: 1000</code></pre>
<p><br>
The Mantel test, tests if two distance matrices co-vary. So, it tests if the data in matrix 1 changes in the same way as the data in matrix 2.
<br>
First, we’ll subset our OTU table to the samples that we also have SCFA information about.
<br></p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="free-space.html#cb135-1" aria-hidden="true" tabindex="-1"></a>OTU.SCFA <span class="ot">=</span> OTU.clean[<span class="fu">row.names</span>(OTU.clean) <span class="sc">%in%</span> <span class="fu">paste</span>(<span class="fu">row.names</span>(SCFA), <span class="st">&quot;.F&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),]</span></code></pre></div>
<p><br>
Then, we’ll calculate the distances for each matrix and run the Mantel.
<br></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="free-space.html#cb136-1" aria-hidden="true" tabindex="-1"></a>dist1 <span class="ot">=</span> <span class="fu">vegdist</span>(OTU.SCFA)</span>
<span id="cb136-2"><a href="free-space.html#cb136-2" aria-hidden="true" tabindex="-1"></a>dist2 <span class="ot">=</span> <span class="fu">vegdist</span>(SCFA)</span>
<span id="cb136-3"><a href="free-space.html#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mantel</span>(dist1, dist2)</span></code></pre></div>
<pre><code>## 
## Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel(xdis = dist1, ydis = dist2) 
## 
## Mantel statistic r: -0.02423 
##       Significance: 0.54167 
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.540 0.552 0.596 0.629 
## Permutation: free
## Number of permutations: 23</code></pre>
<p><br>
We can see that the overall OTU table and SCFA tables do not co-vary.
<br>
Sometimes it will be clear from nMDS that one group tends to vary more than other groups. We can test this with multivariate homogeneity of group dispersion. We’ll use Bray-Curtis to demonstrate this. <br>
First we’ll calculate the dispersion in each group. Then, we’ll perform an ANOVA-like test to determine if the variances differ by groups.
<br></p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="free-space.html#cb138-1" aria-hidden="true" tabindex="-1"></a>disp.age <span class="ot">=</span> <span class="fu">betadisper</span>(BC.dist, meta<span class="sc">$</span>AgeGroup)</span>
<span id="cb138-2"><a href="free-space.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(disp.age, <span class="at">pairwise =</span> <span class="cn">TRUE</span>, <span class="at">permutations =</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## 
## Permutation test for homogeneity of multivariate dispersions
## Permutation: free
## Number of permutations: 1000
## 
## Response: Distances
##           Df  Sum Sq  Mean Sq     F N.Perm   Pr(&gt;F)    
## Groups     2 0.47459 0.237293 30.93   1000 0.000999 ***
## Residuals 21 0.16111 0.007672                          
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Pairwise comparisons:
## (Observed p-value below diagonal, permuted p-value above diagonal)
##            1yr         2w     8w
## 1yr            9.9900e-04 0.0010
## 2w  4.8556e-06            0.7602
## 8w  1.2886e-06 7.7206e-01</code></pre>
<p><br>
If we also look at the Bray-Curtis plot we made earlier, we can conclude that 2 and 8 week old calves have a similar variability in their fecal microbiota. They also have more variable fecal microbiotas than 1 year old heifers.</p>
<p><strong>OTU’s that differ by</strong>
<br>
The SIMPER function gives us a list of the OTU’s that cumulatively explain more than 70% of the variation between samples. In our case, we can use this function to see if specific OTU’s differ between the three age groups, even if the overall microbiota doesn’t differ between the age groups.
<br></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="free-space.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">simper</span>(OTU.clean, meta<span class="sc">$</span>AgeGroup, <span class="at">permutations =</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## cumulative contributions of most influential species:
## 
## $`1yr_2w`
##  Otu00002  Otu00001  Otu00003  Otu00007  Otu00011  Otu00006  Otu00009  Otu00014 
## 0.0983761 0.1627191 0.2225335 0.2657879 0.2982889 0.3271508 0.3514210 0.3660756 
##  Otu00022  Otu00018  Otu00012  Otu00016  Otu00004  Otu00021  Otu00008  Otu00025 
## 0.3793171 0.3924608 0.4048922 0.4171422 0.4283988 0.4385280 0.4479076 0.4565849 
##  Otu00028  Otu00023  Otu00037  Otu00013  Otu00035  Otu00055  Otu00030  Otu00036 
## 0.4646081 0.4723795 0.4790690 0.4857141 0.4920793 0.4983615 0.5045449 0.5106265 
##  Otu00040  Otu00042  Otu00010  Otu00049  Otu00046  Otu00033  Otu00031  Otu00081 
## 0.5166717 0.5226378 0.5274331 0.5321886 0.5368030 0.5413764 0.5458188 0.5500936 
##  Otu00051  Otu00064  Otu00056  Otu00032  Otu00052  Otu00062  Otu00026  Otu00020 
## 0.5543565 0.5582465 0.5620674 0.5657989 0.5695078 0.5730822 0.5765920 0.5799406 
##  Otu00074  Otu00069  Otu00066  Otu00077  Otu00148  Otu00073  Otu00067  Otu00065 
## 0.5831741 0.5864067 0.5895953 0.5927428 0.5958511 0.5989588 0.6020549 0.6051241 
##  Otu00076  Otu00075  Otu00091  Otu00048  Otu00097  Otu00068  Otu00050  Otu00084 
## 0.6081334 0.6111073 0.6140400 0.6169121 0.6196512 0.6223697 0.6250661 0.6277023 
##  Otu00100  Otu00019  Otu00063  Otu00039  Otu00086  Otu00071  Otu00101  Otu00089 
## 0.6303356 0.6329664 0.6355752 0.6381709 0.6406744 0.6431362 0.6455850 0.6480310 
##  Otu00096  Otu00095  Otu00108  Otu00088  Otu00103  Otu00094  Otu00098  Otu00116 
## 0.6504700 0.6528884 0.6553007 0.6576757 0.6600472 0.6624184 0.6647575 0.6670589 
##  Otu00090  Otu00105  Otu00104  Otu00099  Otu00059  Otu00106  Otu00115  Otu00102 
## 0.6693444 0.6716046 0.6738590 0.6760506 0.6781917 0.6803196 0.6824245 0.6844633 
##  Otu00110  Otu00119  Otu00118  Otu00034  Otu00114  Otu00093  Otu00124  Otu00045 
## 0.6865021 0.6884972 0.6904775 0.6924261 0.6943714 0.6962690 0.6981558 0.7000319 
## 
## $`1yr_8w`
##   Otu00001   Otu00005   Otu00006   Otu00004   Otu00010   Otu00017   Otu00008 
## 0.03765603 0.07335078 0.10010930 0.12226268 0.14087762 0.15688502 0.17205091 
##   Otu00009   Otu00015   Otu00018   Otu00016   Otu00014   Otu00029   Otu00019 
## 0.18718833 0.20107546 0.21456235 0.22713556 0.23964967 0.25102468 0.26162658 
##   Otu00021   Otu00025   Otu00024   Otu00037   Otu00035   Otu00044   Otu00055 
## 0.27202671 0.28093293 0.28829315 0.29516652 0.30170335 0.30821052 0.31465848 
##   Otu00027   Otu00036   Otu00040   Otu00042   Otu00020   Otu00013   Otu00041 
## 0.32109529 0.32733731 0.33354206 0.33966556 0.34564370 0.35158279 0.35717451 
##   Otu00003   Otu00043   Otu00038   Otu00026   Otu00034   Otu00049   Otu00070 
## 0.36261926 0.36799345 0.37334038 0.37836130 0.38334135 0.38822230 0.39310161 
##   Otu00046   Otu00012   Otu00058   Otu00011   Otu00051   Otu00054   Otu00045 
## 0.39783775 0.40234701 0.40670755 0.41102172 0.41521298 0.41939306 0.42353985 
##   Otu00047   Otu00064   Otu00056   Otu00052   Otu00048   Otu00002   Otu00062 
## 0.42764688 0.43163954 0.43556497 0.43937178 0.44313291 0.44683135 0.45050368 
##   Otu00031   Otu00057   Otu00061   Otu00053   Otu00074   Otu00069   Otu00066 
## 0.45405112 0.45759807 0.46109474 0.46455875 0.46787762 0.47119548 0.47447192 
##   Otu00077   Otu00073   Otu00067   Otu00079   Otu00083   Otu00078   Otu00076 
## 0.47770248 0.48089214 0.48406988 0.48721802 0.49033806 0.49342871 0.49651735 
##   Otu00075   Otu00091   Otu00121   Otu00097   Otu00092   Otu00032   Otu00084 
## 0.49956976 0.50257978 0.50549547 0.50830678 0.51111612 0.51389884 0.51660098 
##   Otu00129   Otu00050   Otu00100   Otu00101   Otu00096   Otu00108   Otu00095 
## 0.51922111 0.52181856 0.52434751 0.52686095 0.52936793 0.53184756 0.53429667 
##   Otu00086   Otu00089   Otu00088   Otu00103   Otu00094   Otu00098   Otu00116 
## 0.53674109 0.53918547 0.54162316 0.54405719 0.54649097 0.54889172 0.55125394 
##   Otu00105   Otu00104   Otu00143   Otu00123   Otu00082   Otu00039   Otu00099 
## 0.55357747 0.55589135 0.55819397 0.56049152 0.56278380 0.56503978 0.56728918 
##   Otu00130   Otu00090   Otu00106   Otu00107   Otu00115   Otu00087   Otu00153 
## 0.56953083 0.57176616 0.57395024 0.57611979 0.57828018 0.58042631 0.58252590 
##   Otu00102   Otu00110   Otu00119   Otu00118   Otu00022   Otu00072   Otu00080 
## 0.58461849 0.58671108 0.58875879 0.59079874 0.59281824 0.59481609 0.59678509 
##   Otu00093   Otu00124   Otu00112   Otu00122   Otu00131   Otu00132   Otu00134 
## 0.59873275 0.60067308 0.60260107 0.60450552 0.60639869 0.60828362 0.61014314 
##   Otu00128   Otu00125   Otu00133   Otu00159   Otu00139   Otu00127   Otu00114 
## 0.61199594 0.61383412 0.61566158 0.61747930 0.61928689 0.62106367 0.62282385 
##   Otu00137   Otu00136   Otu00194   Otu00138   Otu00144   Otu00142   Otu00135 
## 0.62455846 0.62629042 0.62801571 0.62974033 0.63143945 0.63312281 0.63480281 
##   Otu00147   Otu00120   Otu00188   Otu00126   Otu00028   Otu00211   Otu00154 
## 0.63647550 0.63814069 0.63980299 0.64140642 0.64300322 0.64457174 0.64612078 
##   Otu00146   Otu00173   Otu00156   Otu00158   Otu00157   Otu00060   Otu00168 
## 0.64764950 0.64917769 0.65068721 0.65217234 0.65364696 0.65508066 0.65651008 
##   Otu00140   Otu00163   Otu00171   Otu00113   Otu00178   Otu00200   Otu00165 
## 0.65793253 0.65931862 0.66069801 0.66207484 0.66344999 0.66480785 0.66616041 
##   Otu00170   Otu00164   Otu00187   Otu00151   Otu00213   Otu00149   Otu00183 
## 0.66748648 0.66881018 0.67012189 0.67141176 0.67269928 0.67397558 0.67525135 
##   Otu00192   Otu00167   Otu00177   Otu00181   Otu00180   Otu00236   Otu00186 
## 0.67652371 0.67778788 0.67904574 0.68029263 0.68151160 0.68272731 0.68393783 
##   Otu00199   Otu00253   Otu00150   Otu00204   Otu00169   Otu00218   Otu00189 
## 0.68512983 0.68632029 0.68750539 0.68867418 0.68982822 0.69097221 0.69210846 
##   Otu00182   Otu00184   Otu00226   Otu00270   Otu00172   Otu00225   Otu00185 
## 0.69323878 0.69436709 0.69548866 0.69660494 0.69770318 0.69878699 0.69986670 
##   Otu00203 
## 0.70093653 
## 
## $`2w_8w`
##  Otu00002  Otu00001  Otu00003  Otu00007  Otu00009  Otu00005  Otu00011  Otu00004 
## 0.1101390 0.1804133 0.2466786 0.2952479 0.3351854 0.3745198 0.4100899 0.4397781 
##  Otu00010  Otu00017  Otu00008  Otu00012  Otu00015  Otu00022  Otu00029  Otu00013 
## 0.4641945 0.4818672 0.4987872 0.5154942 0.5307997 0.5454777 0.5580145 0.5704325 
##  Otu00019  Otu00020  Otu00028  Otu00006  Otu00023  Otu00024  Otu00027  Otu00031 
## 0.5824230 0.5910912 0.5996473 0.6081657 0.6166261 0.6247348 0.6322130 0.6396626 
##  Otu00044  Otu00030  Otu00041  Otu00043  Otu00038  Otu00032  Otu00026  Otu00070 
## 0.6468237 0.6539027 0.6600291 0.6659522 0.6718453 0.6776585 0.6834157 0.6887933 
##  Otu00033  Otu00034  Otu00047 
## 0.6940870 0.6992933 0.7044391</code></pre>
<p><br>
These OTU’s contribute to the Bray-Curtis dissimilarity, but they’re not necessarily significantly different. To test if an OTU is significantly different, we can test it with the Kruskal-Wallis test.
<br></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="free-space.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(OTU.clean<span class="sc">$</span>Otu00001 <span class="sc">~</span> meta<span class="sc">$</span>AgeGroup)</span></code></pre></div>
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  OTU.clean$Otu00001 by meta$AgeGroup
## Kruskal-Wallis chi-squared = 15.994, df = 2, p-value = 0.0003364</code></pre>
<p><br>
The p-value for OTU00001 is much lower than 0.05, so this OTU is significantly different between age groups.
<br></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="free-space.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(OTU.clean<span class="sc">$</span>Otu00017 <span class="sc">~</span> meta<span class="sc">$</span>AgeGroup)</span></code></pre></div>
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  OTU.clean$Otu00017 by meta$AgeGroup
## Kruskal-Wallis chi-squared = 4.9767, df = 2, p-value = 0.08305</code></pre>
<p><br>
The p-value for OTU 00017 is bigger than 0.05, so this OTU is not significantly different between age groups.
<br>
I downloaded the simper_pretty and R_krusk scripts from <a href="https://github.com/asteinberger9/seq_scripts" class="uri">https://github.com/asteinberger9/seq_scripts</a> and stored them in the folder “R”. <br>
The simper_pretty script performs the SIMPER function for all comparisons of interest in a data set. The output of this script is a .csv document. <br>
The R_krusk script performs the non-parametric Kruskal-Wallis test on each OTU in the .csv file from the simper_pretty script.
<br></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="free-space.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;R/simper_pretty.R&quot;</span>) <span class="co"># deleted the last line of this script because it kept throwing an error otherwise</span></span>
<span id="cb146-2"><a href="free-space.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;R/R_krusk.R&quot;</span>)</span>
<span id="cb146-3"><a href="free-space.html#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="free-space.html#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="fu">simper.pretty</span>(OTU.clean, meta, <span class="fu">c</span>(<span class="st">&#39;AgeGroup&#39;</span>), <span class="at">perc_cutoff=</span><span class="dv">1</span>, <span class="at">low_cutoff =</span> <span class="st">&#39;y&#39;</span>, <span class="at">low_val=</span><span class="fl">0.01</span>, <span class="st">&#39;Age&#39;</span>)</span>
<span id="cb146-5"><a href="free-space.html#cb146-5" aria-hidden="true" tabindex="-1"></a>simper.results <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/Age_clean_simper.csv&quot;</span>))</span>
<span id="cb146-6"><a href="free-space.html#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.pretty</span>(OTU.clean, meta, simper.results, <span class="fu">c</span>(<span class="st">&#39;AgeGroup&#39;</span>), <span class="st">&#39;Age&#39;</span>, tax)</span>
<span id="cb146-7"><a href="free-space.html#cb146-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-8"><a href="free-space.html#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Importing the K-W results</span></span>
<span id="cb146-9"><a href="free-space.html#cb146-9" aria-hidden="true" tabindex="-1"></a>KW.results <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/Age_krusk_simper.csv&quot;</span>))</span>
<span id="cb146-10"><a href="free-space.html#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Removing non-significant results</span></span>
<span id="cb146-11"><a href="free-space.html#cb146-11" aria-hidden="true" tabindex="-1"></a>KW.results.signif <span class="ot">=</span> KW.results[KW.results<span class="sc">$</span>fdr_krusk_p.val <span class="sc">&lt;</span> <span class="fl">0.05</span>,]</span>
<span id="cb146-12"><a href="free-space.html#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Ordering the results by OTU#</span></span>
<span id="cb146-13"><a href="free-space.html#cb146-13" aria-hidden="true" tabindex="-1"></a>KW.results.signif <span class="ot">=</span> KW.results.signif[<span class="fu">with</span>(KW.results.signif, <span class="fu">order</span>(OTU)),]</span>
<span id="cb146-14"><a href="free-space.html#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(KW.results.signif)</span></code></pre></div>
<p><br>
We can see that there are several OTU’s that differ significantly by age group. <br>
We’ll look at OTU1 as relative abundance.
<br></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="free-space.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Abundance berekenen</span></span>
<span id="cb147-2"><a href="free-space.html#cb147-2" aria-hidden="true" tabindex="-1"></a>abund <span class="ot">=</span> OTU.clean<span class="sc">/</span><span class="fu">rowSums</span>(OTU.clean)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb147-3"><a href="free-space.html#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the abundances</span></span>
<span id="cb147-4"><a href="free-space.html#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(abund<span class="sc">$</span>Otu00001 <span class="sc">~</span> meta<span class="sc">$</span>AgeGroup, <span class="at">ylab =</span> <span class="st">&quot;% Relative abundance&quot;</span>, <span class="at">main =</span> <span class="st">&quot;OTU1&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/OTU1%20relative-1.png" width="672" />
<br>
Looking at the graph, together this the results from the Kruskal-Wallis test, we can say that OTU1 is significantly less abundant in 1-year-old animals than in 2- or 8-week-old animals.
<br>
<br>
To investigate continuous variables, like Average Daily Gain in our case, we cannot use SIMPER.
You could approach the continuous variable as a correlation. In general only strong correlations, with r being greater than 0.5 or smaller than -0.5, should be reported. We’ll use Kendall-Tau to do this because it doesn’t assume linearity or normality.
<br>
To decrease the number of OTU’s tested, we’ll correlate ADG with OTU’s that have at least 5% relative abundance in at least one sample.
<br></p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="free-space.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subsetting the OTU&#39;s with 5% abundance</span></span>
<span id="cb148-2"><a href="free-space.html#cb148-2" aria-hidden="true" tabindex="-1"></a>OTU.abund <span class="ot">=</span> OTU.clean[, <span class="fu">apply</span>(abund, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">&gt;</span> <span class="dv">5</span>))]</span>
<span id="cb148-3"><a href="free-space.html#cb148-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-4"><a href="free-space.html#cb148-4" aria-hidden="true" tabindex="-1"></a>cor.kendall <span class="ot">=</span> <span class="fu">cor</span>(OTU.abund, meta<span class="sc">$</span>ADGKG, <span class="at">method =</span> <span class="st">&quot;kendall&quot;</span>)</span>
<span id="cb148-5"><a href="free-space.html#cb148-5" aria-hidden="true" tabindex="-1"></a>cor.kendall</span></code></pre></div>
<pre><code>##                  [,1]
## Otu00001  0.189852125
## Otu00002  0.211764129
## Otu00003  0.027397313
## Otu00004  0.275867615
## Otu00005  0.165056323
## Otu00006 -0.114462240
## Otu00007  0.143930930
## Otu00008  0.211764129
## Otu00009 -0.177517901
## Otu00010  0.176299258
## Otu00011  0.208334326
## Otu00012  0.017236256
## Otu00013  0.269669049
## Otu00015  0.018077538
## Otu00016 -0.257293680
## Otu00017  0.284293111
## Otu00019  0.172479145
## Otu00020  0.102188122
## Otu00022 -0.034040152
## Otu00023  0.004106646
## Otu00024  0.073416202
## Otu00027  0.412640807
## Otu00029  0.076924424
## Otu00030 -0.077670805
## Otu00031  0.286002668
## Otu00038 -0.271163072
## Otu00041  0.125193349
## Otu00043  0.189645652
## Otu00044  0.239065695
## Otu00053 -0.217652255
## Otu00055 -0.112428004
## Otu00070 -0.037317590</code></pre>
<p><br>
There aren’t any correlations greater than 0.5 or smaller than -0.5, so there aren’t any significant correlations.
<br>
Now, we’ll correlate SCFA’s with OTU’s that have at least 1% relative abundance in at least one sample. Obviously, we’ll only use samples for which we have SCFA data.
<br></p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="free-space.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the abundances</span></span>
<span id="cb150-2"><a href="free-space.html#cb150-2" aria-hidden="true" tabindex="-1"></a>abund.SCFA <span class="ot">=</span> OTU.SCFA<span class="sc">/</span><span class="fu">rowSums</span>(OTU.SCFA)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb150-3"><a href="free-space.html#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="free-space.html#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Subsetting the OTU&#39;s with the cutoff of 1% abundance</span></span>
<span id="cb150-5"><a href="free-space.html#cb150-5" aria-hidden="true" tabindex="-1"></a>OTU.SCFA.abund <span class="ot">=</span> OTU.SCFA[, <span class="fu">apply</span>(abund.SCFA, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">&gt;</span> <span class="dv">1</span>))]</span>
<span id="cb150-6"><a href="free-space.html#cb150-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-7"><a href="free-space.html#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the correlation</span></span>
<span id="cb150-8"><a href="free-space.html#cb150-8" aria-hidden="true" tabindex="-1"></a>cor.kendall <span class="ot">=</span> <span class="fu">cor</span>(OTU.SCFA.abund, SCFA, <span class="at">method =</span> <span class="st">&quot;kendall&quot;</span>)</span>
<span id="cb150-9"><a href="free-space.html#cb150-9" aria-hidden="true" tabindex="-1"></a>cor.kendall</span></code></pre></div>
<pre><code>##             Formate    Acetate Propionate Isobutyrate   Butyrate   iVal.2MB
## Otu00006  0.0000000  0.1825742  0.1825742   0.1825742  0.1825742 -0.1825742
## Otu00014  0.1825742  0.3333333  0.3333333   0.0000000  0.3333333 -0.3333333
## Otu00016 -0.1825742 -0.3333333 -0.3333333  -0.6666667 -0.3333333 -0.3333333
## Otu00018 -0.1825742 -0.3333333 -0.3333333  -0.6666667 -0.3333333 -0.3333333
## Otu00021 -0.9128709 -0.6666667 -0.6666667  -0.3333333 -0.6666667 -0.6666667
## Otu00025  0.9128709  0.6666667  0.6666667   0.3333333  0.6666667  0.6666667
## Otu00035 -0.5477226 -0.6666667 -0.6666667  -1.0000000 -0.6666667 -0.6666667
## Otu00036 -0.5477226 -0.6666667 -0.6666667  -0.3333333 -0.6666667  0.0000000
## Otu00037 -0.1825742  0.0000000  0.0000000   0.3333333  0.0000000  0.0000000
## Otu00040 -0.5477226 -0.6666667 -0.6666667  -1.0000000 -0.6666667 -0.6666667
## Otu00042  0.1825742  0.3333333  0.3333333   0.0000000  0.3333333 -0.3333333
## Otu00046 -0.1825742 -0.3333333 -0.3333333  -0.6666667 -0.3333333 -0.3333333
## Otu00049 -0.1825742 -0.3333333 -0.3333333   0.0000000 -0.3333333  0.3333333
## Otu00051  0.5477226  0.3333333  0.3333333   0.6666667  0.3333333  1.0000000
## Otu00052 -0.5477226 -0.6666667 -0.6666667  -1.0000000 -0.6666667 -0.6666667
## Otu00056 -0.1825742 -0.3333333 -0.3333333  -0.6666667 -0.3333333 -0.3333333
## Otu00064 -0.5477226 -0.3333333 -0.3333333  -0.6666667 -0.3333333 -1.0000000
## Otu00066 -0.5477226 -0.6666667 -0.6666667  -1.0000000 -0.6666667 -0.6666667
## Otu00067  0.1825742  0.0000000  0.0000000   0.3333333  0.0000000  0.6666667
## Otu00069  0.5477226  0.3333333  0.3333333   0.6666667  0.3333333  1.0000000
## Otu00074  0.5477226  0.6666667  0.6666667   0.3333333  0.6666667  0.0000000
## Otu00077  0.1825742  0.3333333  0.3333333   0.6666667  0.3333333  0.3333333
## Otu00088  0.1825742  0.0000000  0.0000000  -0.3333333  0.0000000  0.0000000
## Otu00089  0.1825742  0.0000000  0.0000000  -0.3333333  0.0000000  0.0000000
## Otu00097 -0.1825742  0.0000000  0.0000000   0.3333333  0.0000000  0.0000000
## Otu00100 -0.1825742  0.0000000  0.0000000   0.3333333  0.0000000  0.0000000
## Otu00113 -0.5477226 -0.6666667 -0.6666667  -0.3333333 -0.6666667  0.0000000
## Otu00192  0.5477226  0.6666667  0.6666667   1.0000000  0.6666667  0.6666667
## Otu00295  0.2581989  0.2357023  0.2357023   0.7071068  0.2357023  0.7071068
##            Valerate
## Otu00006  0.1825742
## Otu00014  0.0000000
## Otu00016 -0.6666667
## Otu00018 -0.6666667
## Otu00021 -0.3333333
## Otu00025  0.3333333
## Otu00035 -1.0000000
## Otu00036 -0.3333333
## Otu00037  0.3333333
## Otu00040 -1.0000000
## Otu00042  0.0000000
## Otu00046 -0.6666667
## Otu00049  0.0000000
## Otu00051  0.6666667
## Otu00052 -1.0000000
## Otu00056 -0.6666667
## Otu00064 -0.6666667
## Otu00066 -1.0000000
## Otu00067  0.3333333
## Otu00069  0.6666667
## Otu00074  0.3333333
## Otu00077  0.6666667
## Otu00088 -0.3333333
## Otu00089 -0.3333333
## Otu00097  0.3333333
## Otu00100  0.3333333
## Otu00113 -0.3333333
## Otu00192  1.0000000
## Otu00295  0.7071068</code></pre>
<p><br>
This table is very large, so we’ll write it to a table in the project folder.
<br></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="free-space.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(cor.kendall, <span class="at">file =</span> <span class="st">&quot;cor_kendall.csv&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb152-2"><a href="free-space.html#cb152-2" aria-hidden="true" tabindex="-1"></a>cor_kendall <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;cor_kendall.csv&quot;</span>)</span></code></pre></div>
<p><br>
Some OTU’s have a strong correlation with a SCFA. For example, OTU00021 and OTU00025 have a strong correlation with the SCFA Formate. We’ll show this in a plot.
<br></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="free-space.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb153-2"><a href="free-space.html#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(abund.SCFA<span class="sc">$</span>Otu00021 <span class="sc">~</span> SCFA<span class="sc">$</span>Formate, </span>
<span id="cb153-3"><a href="free-space.html#cb153-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Formate (mM)&quot;</span>, </span>
<span id="cb153-4"><a href="free-space.html#cb153-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Relative abundance, %&quot;</span>, </span>
<span id="cb153-5"><a href="free-space.html#cb153-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;OTU21&quot;</span>)</span>
<span id="cb153-6"><a href="free-space.html#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(abund.SCFA<span class="sc">$</span>Otu00025 <span class="sc">~</span> SCFA<span class="sc">$</span>Formate, </span>
<span id="cb153-7"><a href="free-space.html#cb153-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Formate (mM)&quot;</span>, </span>
<span id="cb153-8"><a href="free-space.html#cb153-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Relative abundance, %&quot;</span>, </span>
<span id="cb153-9"><a href="free-space.html#cb153-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;OTU25&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20the%20correlation-1.png" width="672" />
<br>
We don’t have a lot of data points, so we can’t draw strong conclusions from this. However, we can further test the OTU’s that correlate strongly with a SCFA. To do this, we will assume a normal distribution.
<br></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="free-space.html#cb154-1" aria-hidden="true" tabindex="-1"></a>OTU21.Formate <span class="ot">=</span> <span class="fu">glm</span>(OTU.SCFA<span class="sc">$</span>Otu00021 <span class="sc">~</span> SCFA<span class="sc">$</span>Formate)</span>
<span id="cb154-2"><a href="free-space.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(OTU21.Formate)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = OTU.SCFA$Otu00021 ~ SCFA$Formate)
## 
## Deviance Residuals: 
##       1        2        3        4  
## -56.173   96.253  -46.747    6.668  
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)    357.75      51.46   6.952   0.0201 *
## SCFA$Formate  -540.02     201.13  -2.685   0.1152  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 7324.907)
## 
##     Null deviance: 67454  on 3  degrees of freedom
## Residual deviance: 14650  on 2  degrees of freedom
## AIC: 50.175
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="free-space.html#cb156-1" aria-hidden="true" tabindex="-1"></a>OTU25.Formate <span class="ot">=</span> <span class="fu">glm</span>(OTU.SCFA<span class="sc">$</span>Otu00025 <span class="sc">~</span> SCFA<span class="sc">$</span>Formate)</span>
<span id="cb156-2"><a href="free-space.html#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(OTU25.Formate)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = OTU.SCFA$Otu00025 ~ SCFA$Formate)
## 
## Deviance Residuals: 
##        1         2         3         4  
##  127.727  -118.783     6.217   -15.162  
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)    219.78      74.49   2.951   0.0982 .
## SCFA$Formate   721.00     291.12   2.477   0.1316  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 15346.04)
## 
##     Null deviance: 124819  on 3  degrees of freedom
## Residual deviance:  30692  on 2  degrees of freedom
## AIC: 53.133
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p><br>
Turns out, both OTU’s don’t differ significantly with Formate concentration, eventhough they had very strong Kendall correlations.
<br>
<br>
To visualize all the phyla in our samples, we could make an additive bar chart.
<br></p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="free-space.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bar</span>(physeq.tree, <span class="at">fill =</span> <span class="st">&quot;Phylum&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/additive%20bar%20chart-1.png" width="672" />
<br>
To make this graph a bit more readable, we can group it by age.
<br></p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="free-space.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bar</span>(physeq.tree, <span class="at">x =</span> <span class="st">&quot;AgeGroup&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Phylum&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/bar%20chart%20with%20age-1.png" width="672" />
<br>
To make it even clearer, we can remove the lines between the OTU’s.
<br></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="free-space.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bar</span>(physeq.tree, <span class="at">x =</span> <span class="st">&quot;AgeGroup&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Phylum&quot;</span>) <span class="sc">+</span> </span>
<span id="cb160-2"><a href="free-space.html#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">color =</span> Phylum, <span class="at">fill =</span> Phylum), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/another%20bar%20chart-1.png" width="672" />
<br>
We can also modify the bar chart to only show the five most abundant phyla for each age group.
<br></p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="free-space.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorting the phyla by abundance and picking the top 5</span></span>
<span id="cb161-2"><a href="free-space.html#cb161-2" aria-hidden="true" tabindex="-1"></a>top5P.names <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">tapply</span>(<span class="fu">taxa_sums</span>(physeq.tree), <span class="fu">tax_table</span>(physeq.tree)[, <span class="st">&quot;Phylum&quot;</span>], sum), <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb161-3"><a href="free-space.html#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="free-space.html#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cutting the physeq.tree down to the top 10 Phyla</span></span>
<span id="cb161-5"><a href="free-space.html#cb161-5" aria-hidden="true" tabindex="-1"></a>top5P <span class="ot">=</span> <span class="fu">subset_taxa</span>(physeq.tree, Phylum <span class="sc">%in%</span> <span class="fu">names</span>(top5P.names))</span>
<span id="cb161-6"><a href="free-space.html#cb161-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-7"><a href="free-space.html#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the top 5 phyla</span></span>
<span id="cb161-8"><a href="free-space.html#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bar</span>(top5P, <span class="at">x =</span> <span class="st">&quot;AgeGroup&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Phylum&quot;</span>) <span class="sc">+</span> </span>
<span id="cb161-9"><a href="free-space.html#cb161-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">color =</span> Phylum, <span class="at">fill =</span> Phylum), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/top%205%20bar%20chart-1.png" width="672" />
<br>
We can also plot several bar charts next to each other, separated by the phyla.
<br></p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="free-space.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bar</span>(top5P, <span class="at">x =</span> <span class="st">&quot;AgeGroup&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Phylum&quot;</span>, <span class="at">facet_grid =</span> <span class="sc">~</span>Phylum) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">color =</span> Phylum, <span class="at">fill =</span> Phylum), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/separated%20bar%20charts-1.png" width="672" />
<br>
We can also plot phylogenetic trees. For now, we’ll look at the genus <em>Prevotella</em>. <br> To do this, we firtt need to make a subset with only the <em>Prevotella</em> genus.
<br></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="free-space.html#cb163-1" aria-hidden="true" tabindex="-1"></a>prevotella <span class="ot">=</span> <span class="fu">subset_taxa</span>(physeq.tree, Genus <span class="sc">==</span> <span class="st">&quot;g__Prevotella&quot;</span>)</span></code></pre></div>
<p><br>
To see if this worked, we can compare the number of taxa in our new subset and the original physeq tree.
<br></p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="free-space.html#cb164-1" aria-hidden="true" tabindex="-1"></a>physeq.tree</span></code></pre></div>
<pre><code>## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 5002 taxa and 24 samples ]
## sample_data() Sample Data:       [ 24 samples by 9 sample variables ]
## tax_table()   Taxonomy Table:    [ 5002 taxa by 7 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 5002 tips and 5000 internal nodes ]</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="free-space.html#cb166-1" aria-hidden="true" tabindex="-1"></a>prevotella</span></code></pre></div>
<pre><code>## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 106 taxa and 24 samples ]
## sample_data() Sample Data:       [ 24 samples by 9 sample variables ]
## tax_table()   Taxonomy Table:    [ 106 taxa by 7 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 106 tips and 105 internal nodes ]</code></pre>
<p><br>
Next, we can plot the OTUs on a tree.
<br></p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="free-space.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tree</span>(prevotella, <span class="at">plot.margin =</span> <span class="fl">0.5</span>, <span class="at">ladderize =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/OTU%20tree-1.png" width="672" />
<br>
This tree isn’t very useful or readable yet. We can add colors for the age groups, size the dots according to the OTU abundance and species level labels for the OTUs.
<br></p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="free-space.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tree</span>(prevotella, <span class="at">color =</span> <span class="st">&quot;AgeGroup&quot;</span>, <span class="at">label.tips =</span> <span class="st">&quot;Species&quot;</span>, <span class="at">size =</span> <span class="st">&quot;abundance&quot;</span>, <span class="at">plot.margin =</span> <span class="fl">0.5</span>, <span class="at">ladderize =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/better%20OTU%20tree-1.png" width="672" />
<br>
We can also visualize the abundance in a heatmap. To make a heatmap a bit readable, we’ll only use the 20 most abundant OTUs.
<br></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="free-space.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorting the OTUs by abundance and picking the top 20</span></span>
<span id="cb170-2"><a href="free-space.html#cb170-2" aria-hidden="true" tabindex="-1"></a>top20OTU.names <span class="ot">=</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">taxa_sums</span>(physeq.tree), <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb170-3"><a href="free-space.html#cb170-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-4"><a href="free-space.html#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cutting down the physeq.tree to only the top 10 Phyla</span></span>
<span id="cb170-5"><a href="free-space.html#cb170-5" aria-hidden="true" tabindex="-1"></a>top20OTU <span class="ot">=</span> <span class="fu">prune_taxa</span>(top20OTU.names, physeq.tree)</span>
<span id="cb170-6"><a href="free-space.html#cb170-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-7"><a href="free-space.html#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We can see we now only have 20 taxa</span></span>
<span id="cb170-8"><a href="free-space.html#cb170-8" aria-hidden="true" tabindex="-1"></a>top20OTU</span></code></pre></div>
<pre><code>## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 20 taxa and 24 samples ]
## sample_data() Sample Data:       [ 24 samples by 9 sample variables ]
## tax_table()   Taxonomy Table:    [ 20 taxa by 7 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 20 tips and 19 internal nodes ]</code></pre>
<p><br>
Now, we can make a heatmap.
<br></p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="free-space.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_heatmap</span>(top20OTU)</span></code></pre></div>
<p><img src="_main_files/figure-html/heatmap%20top%2020-1.png" width="672" />
<br>
We can also group it by age.
<br></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="free-space.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_heatmap</span>(top20OTU, <span class="at">sample.label =</span> <span class="st">&quot;AgeGroup&quot;</span>, <span class="at">sample.order =</span> <span class="st">&quot;AgeGroup&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/heatmap%20top%2020%20grouped-1.png" width="672" />
<br>
We can also label the OTU taxa.
<br></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="free-space.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_heatmap</span>(top20OTU, </span>
<span id="cb174-2"><a href="free-space.html#cb174-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample.label =</span> <span class="st">&quot;AgeGroup&quot;</span>, </span>
<span id="cb174-3"><a href="free-space.html#cb174-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample.order =</span> <span class="st">&quot;AgeGroup&quot;</span>, </span>
<span id="cb174-4"><a href="free-space.html#cb174-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">taxa.label =</span> <span class="st">&quot;Genus&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/heatmap%20top%2020%20labelled-1.png" width="672" />
<br>
We can also group OTUs in the same Phyla.
<br></p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="free-space.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_heatmap</span>(top20OTU, </span>
<span id="cb175-2"><a href="free-space.html#cb175-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample.label =</span> <span class="st">&quot;AgeGroup&quot;</span>, </span>
<span id="cb175-3"><a href="free-space.html#cb175-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample.order =</span> <span class="st">&quot;AgeGroup&quot;</span>, </span>
<span id="cb175-4"><a href="free-space.html#cb175-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">taxa.label =</span> <span class="st">&quot;Genus&quot;</span>, </span>
<span id="cb175-5"><a href="free-space.html#cb175-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">taxa.order =</span> <span class="st">&quot;Phylum&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/heatmap%20top%2020%20grouped%20OTUs-1.png" width="672" />
<br>
We can also change the colors.
<br></p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="free-space.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_heatmap</span>(top20OTU, </span>
<span id="cb176-2"><a href="free-space.html#cb176-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample.label =</span> <span class="st">&quot;AgeGroup&quot;</span>, </span>
<span id="cb176-3"><a href="free-space.html#cb176-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample.order =</span> <span class="st">&quot;AgeGroup&quot;</span>, </span>
<span id="cb176-4"><a href="free-space.html#cb176-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">taxa.label =</span> <span class="st">&quot;Genus&quot;</span>, </span>
<span id="cb176-5"><a href="free-space.html#cb176-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">taxa.order =</span> <span class="st">&quot;Phylum&quot;</span>, </span>
<span id="cb176-6"><a href="free-space.html#cb176-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">low =</span> <span class="st">&quot;white&quot;</span>, </span>
<span id="cb176-7"><a href="free-space.html#cb176-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">high =</span> <span class="st">&quot;purple&quot;</span>, </span>
<span id="cb176-8"><a href="free-space.html#cb176-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">na.value =</span> <span class="st">&quot;grey&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/heatmap%20diff%20colors-1.png" width="672" />
<br>
We cal also plot the Bray-Curtis dissimilarity in a heatmap.
<br></p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="free-space.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_heatmap</span>(top20OTU, <span class="st">&quot;NMDS&quot;</span>, <span class="st">&quot;bray&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Bray-Curtis&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/BC%20heatmap-1.png" width="672" />
<br>
We can also use heatmaps to show the distance between samples, also known as the beta-diversity. We can use the distance matrices as input for this heatmap. We’ll use a gplots command for this.
<br></p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="free-space.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap.2</span>(<span class="fu">as.matrix</span>(BC.dist))</span></code></pre></div>
<p><img src="_main_files/figure-html/BC%20beta%20heatmap-1.png" width="672" />
<br>
We can also use this for UniFrac.
<br></p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="free-space.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap.2</span>(<span class="fu">as.matrix</span>(wUF.dist))</span></code></pre></div>
<p><img src="_main_files/figure-html/UniFrac%20heatmap-1.png" width="672" />
<br>
We can also change the colors of the heatmap.
<br></p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="free-space.html#cb180-1" aria-hidden="true" tabindex="-1"></a>rc <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">nrow</span>(<span class="fu">as.matrix</span>(BC.dist)), <span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> <span class="fl">0.9</span>)</span>
<span id="cb180-2"><a href="free-space.html#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap.2</span>(<span class="fu">as.matrix</span>(BC.dist), <span class="at">col =</span> rc)</span></code></pre></div>
<p><img src="_main_files/figure-html/rainbow%20BC%20heatmap-1.png" width="672" />
<br>
Next, we’ll make Venn diagrams of the samples 5017.2w.F, 5017.8w.F and 5017.1yr.F. <br>
First, we’ll make a list of the OTUs that occur in the three samples.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="free-space.html#cb181-1" aria-hidden="true" tabindex="-1"></a>OTU.<span class="fl">5017.2</span>w <span class="ot">=</span> <span class="fu">colnames</span>(OTU.clean[<span class="st">&quot;5017.2w.F&quot;</span>, <span class="fu">apply</span>(OTU.clean[<span class="st">&quot;5017.2w.F&quot;</span>,], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>))])</span>
<span id="cb181-2"><a href="free-space.html#cb181-2" aria-hidden="true" tabindex="-1"></a>OTU.<span class="fl">5017.8</span>w <span class="ot">=</span> <span class="fu">colnames</span>(OTU.clean[<span class="st">&quot;5017.8w.F&quot;</span>, <span class="fu">apply</span>(OTU.clean[<span class="st">&quot;5017.8w.F&quot;</span>,], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>))])</span>
<span id="cb181-3"><a href="free-space.html#cb181-3" aria-hidden="true" tabindex="-1"></a>OTU.<span class="fl">5017.1</span>yr <span class="ot">=</span> <span class="fu">colnames</span>(OTU.clean[<span class="st">&quot;5017.1yr.F&quot;</span>, <span class="fu">apply</span>(OTU.clean[<span class="st">&quot;5017.1yr.F&quot;</span>,], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>))])</span></code></pre></div>
<p><br>
Now we can use these three lists to make a Venn diagram.
<br></p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="free-space.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">venn</span>(<span class="fu">list</span>(OTU.<span class="fl">5017.2</span>w, OTU.<span class="fl">5017.8</span>w, OTU.<span class="fl">5017.1</span>yr))</span></code></pre></div>
<p><img src="_main_files/figure-html/Venn%20diagram%205017-1.png" width="672" />
<br>
We can also make a Venn diagram for the three age groups.
<br></p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="free-space.html#cb183-1" aria-hidden="true" tabindex="-1"></a>OTU<span class="fl">.2</span>w <span class="ot">=</span> <span class="fu">colnames</span>(OTU.clean[meta<span class="sc">$</span>AgeGroup <span class="sc">==</span> <span class="st">&quot;2w&quot;</span>, <span class="fu">apply</span>(OTU.clean[meta<span class="sc">$</span>AgeGroup <span class="sc">==</span> <span class="st">&quot;2w&quot;</span>,], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>))])</span>
<span id="cb183-2"><a href="free-space.html#cb183-2" aria-hidden="true" tabindex="-1"></a>OTU<span class="fl">.8</span>w <span class="ot">=</span> <span class="fu">colnames</span>(OTU.clean[meta<span class="sc">$</span>AgeGroup <span class="sc">==</span> <span class="st">&quot;8w&quot;</span>, <span class="fu">apply</span>(OTU.clean[meta<span class="sc">$</span>AgeGroup <span class="sc">==</span> <span class="st">&quot;8w&quot;</span>,], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>))])</span>
<span id="cb183-3"><a href="free-space.html#cb183-3" aria-hidden="true" tabindex="-1"></a>OTU<span class="fl">.1</span>yr <span class="ot">=</span> <span class="fu">colnames</span>(OTU.clean[meta<span class="sc">$</span>AgeGroup <span class="sc">==</span> <span class="st">&quot;1yr&quot;</span>, <span class="fu">apply</span>(OTU.clean[meta<span class="sc">$</span>AgeGroup <span class="sc">==</span> <span class="st">&quot;1yr&quot;</span>,], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>))])</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="free-space.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">venn</span>(<span class="fu">list</span>(OTU<span class="fl">.2</span>w, OTU<span class="fl">.8</span>w, OTU<span class="fl">.1</span>yr))</span></code></pre></div>
<p><img src="_main_files/figure-html/Venn%20diagram%20age%20groups-1.png" width="672" />
<br>
We can make this Venn diagram a lot prettier!
<br></p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="free-space.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">draw.triple.venn</span>(<span class="at">area1 =</span> <span class="dv">385</span><span class="sc">+</span><span class="dv">58</span><span class="sc">+</span><span class="dv">71</span><span class="sc">+</span><span class="dv">320</span>, </span>
<span id="cb185-2"><a href="free-space.html#cb185-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">area2 =</span> <span class="dv">801</span><span class="sc">+</span><span class="dv">190</span><span class="sc">+</span><span class="dv">320</span><span class="sc">+</span><span class="dv">71</span>, </span>
<span id="cb185-3"><a href="free-space.html#cb185-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">area3 =</span> <span class="dv">3177</span><span class="sc">+</span><span class="dv">190</span><span class="sc">+</span><span class="dv">58</span><span class="sc">+</span><span class="dv">71</span>, </span>
<span id="cb185-4"><a href="free-space.html#cb185-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n12 =</span> <span class="dv">320</span><span class="sc">+</span><span class="dv">17</span>, </span>
<span id="cb185-5"><a href="free-space.html#cb185-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n23 =</span> <span class="dv">190</span><span class="sc">+</span><span class="dv">71</span>, </span>
<span id="cb185-6"><a href="free-space.html#cb185-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n13 =</span> <span class="dv">58</span><span class="sc">+</span><span class="dv">71</span>, </span>
<span id="cb185-7"><a href="free-space.html#cb185-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n123 =</span> <span class="dv">17</span>, </span>
<span id="cb185-8"><a href="free-space.html#cb185-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">category =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb185-9"><a href="free-space.html#cb185-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lty =</span> <span class="st">&quot;blank&quot;</span>, </span>
<span id="cb185-10"><a href="free-space.html#cb185-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/prettier%20Venn%20diagram-1.png" width="672" /></p>
<pre><code>## (polygon[GRID.polygon.1870], polygon[GRID.polygon.1871], polygon[GRID.polygon.1872], polygon[GRID.polygon.1873], polygon[GRID.polygon.1874], polygon[GRID.polygon.1875], text[GRID.text.1876], text[GRID.text.1877], text[GRID.text.1878], text[GRID.text.1879], text[GRID.text.1880], text[GRID.text.1881], text[GRID.text.1882], text[GRID.text.1883], text[GRID.text.1884], text[GRID.text.1885])</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="free-space.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This doesn&#39;t show the Venn diagram, I think because I can&#39;t load the venneuler package?</span></span></code></pre></div>
<p><br>
With the venneuler package, we can scale the circles to be proportional to the the total number of OTUs in that group.
<br></p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="free-space.html#cb188-1" aria-hidden="true" tabindex="-1"></a>age.venn <span class="ot">=</span> <span class="fu">venneuler</span>(<span class="fu">c</span>(</span>
<span id="cb188-2"><a href="free-space.html#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;A&#39;</span> <span class="ot">=</span> <span class="dv">385</span><span class="sc">+</span><span class="dv">58</span><span class="sc">+</span><span class="dv">71</span><span class="sc">+</span><span class="dv">320</span>, </span>
<span id="cb188-3"><a href="free-space.html#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;B&#39;</span> <span class="ot">=</span> <span class="dv">801</span><span class="sc">+</span><span class="dv">190</span><span class="sc">+</span><span class="dv">320</span><span class="sc">+</span><span class="dv">17</span>, </span>
<span id="cb188-4"><a href="free-space.html#cb188-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;C&#39;</span> <span class="ot">=</span> <span class="dv">3177</span><span class="sc">+</span><span class="dv">190</span><span class="sc">+</span><span class="dv">58</span><span class="sc">+</span><span class="dv">17</span>, </span>
<span id="cb188-5"><a href="free-space.html#cb188-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;A&amp;B&#39;</span> <span class="ot">=</span> <span class="dv">320</span><span class="sc">+</span><span class="dv">71</span>, </span>
<span id="cb188-6"><a href="free-space.html#cb188-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;B&amp;C&#39;</span> <span class="ot">=</span> <span class="dv">190</span><span class="sc">+</span><span class="dv">71</span>, </span>
<span id="cb188-7"><a href="free-space.html#cb188-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;A&amp;C&#39;</span> <span class="ot">=</span> <span class="dv">58</span><span class="sc">+</span><span class="dv">71</span>, </span>
<span id="cb188-8"><a href="free-space.html#cb188-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;A&amp;B&amp;C&#39;</span> <span class="ot">=</span> <span class="dv">71</span>))</span>
<span id="cb188-9"><a href="free-space.html#cb188-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-10"><a href="free-space.html#cb188-10" aria-hidden="true" tabindex="-1"></a>age.venn<span class="sc">$</span>labels <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>)</span>
<span id="cb188-11"><a href="free-space.html#cb188-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-12"><a href="free-space.html#cb188-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age.venn)</span></code></pre></div>
<p><br>
We can also plot the distances between the OTUs as a network. We’ll do this with the Prevotella subset to keep it readable.
<br></p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="free-space.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_net</span>(prevotella, <span class="at">color =</span> <span class="st">&quot;Species&quot;</span>, <span class="at">type =</span> <span class="st">&quot;taxa&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/Prevotella%20network-1.png" width="672" />
<br>
We can also plot the beta-diversity as a network. The lines represent the distances between the samples in that case.
<br></p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="free-space.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_net</span>(physeq.tree, <span class="at">color =</span> <span class="st">&quot;AgeGroup&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;bray&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/beta-diversity%20network-1.png" width="672" />
<br>
<br>
Ideally you’d export the figures you want to use for a publication as PostScript (.ps) or PDF (.pdf). <br>
For PostScript, we’ll use the following code.
<br></p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="free-space.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postscript</span>(<span class="st">&quot;Fig1.ps&quot;</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">3</span>, <span class="at">horizontal =</span> <span class="cn">FALSE</span>, <span class="at">colormodel =</span> <span class="st">&quot;rgb&quot;</span>, <span class="at">family =</span> <span class="st">&quot;ArialMT&quot;</span>)</span>
<span id="cb191-2"><a href="free-space.html#cb191-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb191-3"><a href="free-space.html#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">heights=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb191-4"><a href="free-space.html#cb191-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb191-5"><a href="free-space.html#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BC.nmds, </span>
<span id="cb191-6"><a href="free-space.html#cb191-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb191-7"><a href="free-space.html#cb191-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Bray-Curtis&quot;</span>)</span>
<span id="cb191-8"><a href="free-space.html#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(BC.nmds, </span>
<span id="cb191-9"><a href="free-space.html#cb191-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">display=</span><span class="st">&quot;sites&quot;</span>, </span>
<span id="cb191-10"><a href="free-space.html#cb191-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span><span class="dv">20</span>, </span>
<span id="cb191-11"><a href="free-space.html#cb191-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>)[meta<span class="sc">$</span>AgeGroup])</span>
<span id="cb191-12"><a href="free-space.html#cb191-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb191-13"><a href="free-space.html#cb191-13" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(shannon <span class="sc">~</span> AgeGroup.ord, </span>
<span id="cb191-14"><a href="free-space.html#cb191-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">data=</span>meta, </span>
<span id="cb191-15"><a href="free-space.html#cb191-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">&quot;Diversity&quot;</span>, </span>
<span id="cb191-16"><a href="free-space.html#cb191-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">&quot;Shannon&#39;s diversity&quot;</span>, </span>
<span id="cb191-17"><a href="free-space.html#cb191-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span>
<span id="cb191-18"><a href="free-space.html#cb191-18" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb191-19"><a href="free-space.html#cb191-19" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><br>
To export a PDF, we’ll use the following code.
<br></p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="free-space.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;Fig1.pdf&quot;</span>, </span>
<span id="cb192-2"><a href="free-space.html#cb192-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">7</span>, </span>
<span id="cb192-3"><a href="free-space.html#cb192-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">3</span>,  </span>
<span id="cb192-4"><a href="free-space.html#cb192-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">colormodel =</span> <span class="st">&quot;rgb&quot;</span>, </span>
<span id="cb192-5"><a href="free-space.html#cb192-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;ArialMT&quot;</span>)</span>
<span id="cb192-6"><a href="free-space.html#cb192-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb192-7"><a href="free-space.html#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">heights=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb192-8"><a href="free-space.html#cb192-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb192-9"><a href="free-space.html#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BC.nmds, </span>
<span id="cb192-10"><a href="free-space.html#cb192-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb192-11"><a href="free-space.html#cb192-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Bray-Curtis&quot;</span>)</span>
<span id="cb192-12"><a href="free-space.html#cb192-12" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(BC.nmds, </span>
<span id="cb192-13"><a href="free-space.html#cb192-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">display=</span><span class="st">&quot;sites&quot;</span>, </span>
<span id="cb192-14"><a href="free-space.html#cb192-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span><span class="dv">20</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>)[meta<span class="sc">$</span>AgeGroup])</span>
<span id="cb192-15"><a href="free-space.html#cb192-15" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb192-16"><a href="free-space.html#cb192-16" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(shannon <span class="sc">~</span> AgeGroup.ord, </span>
<span id="cb192-17"><a href="free-space.html#cb192-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">data=</span>meta, <span class="at">main=</span><span class="st">&quot;Diversity&quot;</span>, </span>
<span id="cb192-18"><a href="free-space.html#cb192-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">&quot;Shannon&#39;s diversity&quot;</span>, </span>
<span id="cb192-19"><a href="free-space.html#cb192-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span>
<span id="cb192-20"><a href="free-space.html#cb192-20" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb192-21"><a href="free-space.html#cb192-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><br>
Lastly, we can export is as a PNG with the following code.
<br></p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="free-space.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;Fig1.png&quot;</span>, </span>
<span id="cb193-2"><a href="free-space.html#cb193-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">7</span>, </span>
<span id="cb193-3"><a href="free-space.html#cb193-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">3</span>, </span>
<span id="cb193-4"><a href="free-space.html#cb193-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">units=</span><span class="st">&#39;in&#39;</span>, </span>
<span id="cb193-5"><a href="free-space.html#cb193-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">res=</span><span class="dv">300</span>)</span>
<span id="cb193-6"><a href="free-space.html#cb193-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb193-7"><a href="free-space.html#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">heights=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb193-8"><a href="free-space.html#cb193-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb193-9"><a href="free-space.html#cb193-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BC.nmds, </span>
<span id="cb193-10"><a href="free-space.html#cb193-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb193-11"><a href="free-space.html#cb193-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Bray-Curtis&quot;</span>)</span>
<span id="cb193-12"><a href="free-space.html#cb193-12" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(BC.nmds, </span>
<span id="cb193-13"><a href="free-space.html#cb193-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">display=</span><span class="st">&quot;sites&quot;</span>, </span>
<span id="cb193-14"><a href="free-space.html#cb193-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span><span class="dv">20</span>, </span>
<span id="cb193-15"><a href="free-space.html#cb193-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>)[meta<span class="sc">$</span>AgeGroup])</span>
<span id="cb193-16"><a href="free-space.html#cb193-16" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb193-17"><a href="free-space.html#cb193-17" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(shannon <span class="sc">~</span> AgeGroup.ord, </span>
<span id="cb193-18"><a href="free-space.html#cb193-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">data=</span>meta, </span>
<span id="cb193-19"><a href="free-space.html#cb193-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">&quot;Diversity&quot;</span>, </span>
<span id="cb193-20"><a href="free-space.html#cb193-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">&quot;Shannon&#39;s diversity&quot;</span>, c</span>
<span id="cb193-21"><a href="free-space.html#cb193-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">ol=</span><span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span>
<span id="cb193-22"><a href="free-space.html#cb193-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb193-23"><a href="free-space.html#cb193-23" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><strong>End of tutorial</strong></p>
<p>Now, to show you what I’ve learned, I have written a bit of my own code aswell.
<br>
In the tutorial, we tested if the interaction between age and ADG significantly impacted Shannon’s diversity, which it didn’t. I will test if the interaction between age and ADG significantly impacts ACE richness.
<br></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="free-space.html#cb194-1" aria-hidden="true" tabindex="-1"></a>qp.ace <span class="ot">=</span> <span class="fu">glm</span>(ace <span class="sc">~</span> AgeGroup<span class="sc">*</span>ADGKG, <span class="at">data =</span> meta, <span class="at">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span>
<span id="cb194-2"><a href="free-space.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(qp.ace)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ace ~ AgeGroup * ADGKG, family = &quot;quasipoisson&quot;, 
##     data = meta)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -10.4865   -3.5380   -0.3493    3.4173    9.8904  
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       6.99834    0.96429   7.257 9.53e-07 ***
## AgeGroup2w       -1.06925    1.00243  -1.067   0.3002    
## AgeGroup8w       -2.55146    1.19928  -2.127   0.0475 *  
## ADGKG             0.07922    1.02609   0.077   0.9393    
## AgeGroup2w:ADGKG -0.84234    1.07245  -0.785   0.4424    
## AgeGroup8w:ADGKG  1.05107    1.18628   0.886   0.3873    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 36.85831)
## 
##     Null deviance: 8622.53  on 23  degrees of freedom
## Residual deviance:  671.22  on 18  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><br>
The interactions aren’t significant, so we’ll remove these and run glm again.
<br></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="free-space.html#cb196-1" aria-hidden="true" tabindex="-1"></a>qp.ace2 <span class="ot">=</span> <span class="fu">glm</span>(ace <span class="sc">~</span> AgeGroup<span class="sc">+</span>ADGKG, <span class="at">data =</span> meta, <span class="at">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span>
<span id="cb196-2"><a href="free-space.html#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(qp.ace2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ace ~ AgeGroup + ADGKG, family = &quot;quasipoisson&quot;, 
##     data = meta)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -9.014  -4.520  -2.484   3.584  10.797  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   7.3609     0.3081  23.889 3.55e-16 ***
## AgeGroup2w   -1.7891     0.1946  -9.196 1.27e-08 ***
## AgeGroup8w   -1.2603     0.1698  -7.420 3.65e-07 ***
## ADGKG        -0.3077     0.3196  -0.963    0.347    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 50.63286)
## 
##     Null deviance: 8622.53  on 23  degrees of freedom
## Residual deviance:  974.03  on 20  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><br>
We can see that now, both age groups have become significant. That means that for both age groups, the difference with 1 year is significant when it comes to ACE richness.
<br>
<br>
In the tutorial, we plotted the genus <em>Reminococcus</em> in a plot with the Bray-Curtis dissimilarity for the three age groups. I will plot the genus <em>Clostridium</em> and <em>Akkermansia</em> in a similar plot.
<br></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="free-space.html#cb198-1" aria-hidden="true" tabindex="-1"></a>OTU.clostridium <span class="ot">=</span> OTU.clean[,tax.clean<span class="sc">$</span>Genus <span class="sc">==</span> <span class="st">&quot;g__Clostridium&quot;</span>]</span>
<span id="cb198-2"><a href="free-space.html#cb198-2" aria-hidden="true" tabindex="-1"></a>OTU.akkermansia <span class="ot">=</span> OTU.clean[,tax.clean<span class="sc">$</span>Genus <span class="sc">==</span> <span class="st">&quot;g__Akkermansia&quot;</span>]</span>
<span id="cb198-3"><a href="free-space.html#cb198-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4"><a href="free-space.html#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summing the abundance of both groups into one variable for each group</span></span>
<span id="cb198-5"><a href="free-space.html#cb198-5" aria-hidden="true" tabindex="-1"></a>OTU.clostridium<span class="sc">$</span>clostridium.sum <span class="ot">=</span> <span class="fu">rowSums</span>(OTU.clostridium)</span>
<span id="cb198-6"><a href="free-space.html#cb198-6" aria-hidden="true" tabindex="-1"></a>OTU.akkermansia<span class="sc">$</span>akkermansia.sum <span class="ot">=</span> <span class="fu">rowSums</span>(OTU.akkermansia)</span>
<span id="cb198-7"><a href="free-space.html#cb198-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-8"><a href="free-space.html#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we&#39;ll fit both groups</span></span>
<span id="cb198-9"><a href="free-space.html#cb198-9" aria-hidden="true" tabindex="-1"></a>fit.BC.Clostridium <span class="ot">=</span> <span class="fu">envfit</span>(BC.nmds, OTU.clostridium<span class="sc">$</span>clostridium.sum)</span>
<span id="cb198-10"><a href="free-space.html#cb198-10" aria-hidden="true" tabindex="-1"></a>fit.BC.Akkermansia <span class="ot">=</span> <span class="fu">envfit</span>(BC.nmds, OTU.akkermansia<span class="sc">$</span>akkermansia.sum)</span>
<span id="cb198-11"><a href="free-space.html#cb198-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-12"><a href="free-space.html#cb198-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Lastly, we&#39;ll plot both groups</span></span>
<span id="cb198-13"><a href="free-space.html#cb198-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BC.nmds, </span>
<span id="cb198-14"><a href="free-space.html#cb198-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb198-15"><a href="free-space.html#cb198-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Bray-Curtis&quot;</span>)</span>
<span id="cb198-16"><a href="free-space.html#cb198-16" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(BC.nmds, </span>
<span id="cb198-17"><a href="free-space.html#cb198-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb198-18"><a href="free-space.html#cb198-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>, </span>
<span id="cb198-19"><a href="free-space.html#cb198-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))[meta<span class="sc">$</span>AgeGroup]</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="free-space.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="sc">-</span><span class="fl">1.1</span>, </span>
<span id="cb200-2"><a href="free-space.html#cb200-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb200-3"><a href="free-space.html#cb200-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb200-4"><a href="free-space.html#cb200-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb200-5"><a href="free-space.html#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.BC.Clostridium, </span>
<span id="cb200-6"><a href="free-space.html#cb200-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, </span>
<span id="cb200-7"><a href="free-space.html#cb200-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels=</span> <span class="fu">c</span>(<span class="st">&quot;Clos&quot;</span>))</span>
<span id="cb200-8"><a href="free-space.html#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.BC.Akkermansia, </span>
<span id="cb200-9"><a href="free-space.html#cb200-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, </span>
<span id="cb200-10"><a href="free-space.html#cb200-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Akk&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/Clostridium%20&%20Akkermansia-1.png" width="672" />
<br>
In the tutorial, we calculated the dispersion/variance for the Bray-Curtis dissimilarity and then plotted it. Here, I did this for the Jaccard index.
<br>
So, I first calculated the dispersion/variances for each group.
<br></p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="free-space.html#cb201-1" aria-hidden="true" tabindex="-1"></a>disp.j.age <span class="ot">=</span> <span class="fu">betadisper</span>(J.dist, meta<span class="sc">$</span>AgeGroup)</span></code></pre></div>
<p><br>
Then, I performed an ANOVA-like test to see if the variances differ by group.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="free-space.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(disp.j.age, <span class="at">pairwise =</span> <span class="cn">TRUE</span>, <span class="at">permutations =</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## 
## Permutation test for homogeneity of multivariate dispersions
## Permutation: free
## Number of permutations: 1000
## 
## Response: Distances
##           Df  Sum Sq  Mean Sq     F N.Perm   Pr(&gt;F)    
## Groups     2 0.47459 0.237293 30.93   1000 0.000999 ***
## Residuals 21 0.16111 0.007672                          
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Pairwise comparisons:
## (Observed p-value below diagonal, permuted p-value above diagonal)
##            1yr         2w     8w
## 1yr            9.9900e-04 0.0010
## 2w  4.8556e-06            0.7662
## 8w  1.2886e-06 7.7206e-01</code></pre>
<p><br>
Then, I plotted the Jaccard index for the three age groups.
<br></p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="free-space.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(J.nmds, </span>
<span id="cb204-2"><a href="free-space.html#cb204-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb204-3"><a href="free-space.html#cb204-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Jaccard index&quot;</span>,</span>
<span id="cb204-4"><a href="free-space.html#cb204-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb204-5"><a href="free-space.html#cb204-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">4</span>, <span class="dv">1</span>, </span>
<span id="cb204-6"><a href="free-space.html#cb204-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>,<span class="st">&quot;8w&quot;</span>,<span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb204-7"><a href="free-space.html#cb204-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;green&quot;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>), </span>
<span id="cb204-8"><a href="free-space.html#cb204-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb204-9"><a href="free-space.html#cb204-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiellipse</span>(BC.nmds, </span>
<span id="cb204-10"><a href="free-space.html#cb204-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">groups=</span>meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb204-11"><a href="free-space.html#cb204-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">display=</span><span class="st">&quot;sites&quot;</span>, </span>
<span id="cb204-12"><a href="free-space.html#cb204-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">kind=</span><span class="st">&quot;se&quot;</span>, </span>
<span id="cb204-13"><a href="free-space.html#cb204-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">conf=</span><span class="fl">0.99</span>, </span>
<span id="cb204-14"><a href="free-space.html#cb204-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">label=</span><span class="cn">FALSE</span>, </span>
<span id="cb204-15"><a href="free-space.html#cb204-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">col=</span><span class="st">&quot;green&quot;</span>, </span>
<span id="cb204-16"><a href="free-space.html#cb204-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">draw=</span><span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb204-17"><a href="free-space.html#cb204-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha=</span><span class="dv">200</span>, </span>
<span id="cb204-18"><a href="free-space.html#cb204-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.groups =</span> <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>), </span>
<span id="cb204-19"><a href="free-space.html#cb204-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">border=</span><span class="cn">FALSE</span>)</span>
<span id="cb204-20"><a href="free-space.html#cb204-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiellipse</span>(BC.nmds, </span>
<span id="cb204-21"><a href="free-space.html#cb204-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">groups=</span>meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb204-22"><a href="free-space.html#cb204-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">display=</span><span class="st">&quot;sites&quot;</span>, </span>
<span id="cb204-23"><a href="free-space.html#cb204-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">kind=</span><span class="st">&quot;se&quot;</span>, </span>
<span id="cb204-24"><a href="free-space.html#cb204-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">conf=</span><span class="fl">0.99</span>, </span>
<span id="cb204-25"><a href="free-space.html#cb204-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">label=</span><span class="cn">FALSE</span>, </span>
<span id="cb204-26"><a href="free-space.html#cb204-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">col=</span><span class="st">&quot;red&quot;</span>, </span>
<span id="cb204-27"><a href="free-space.html#cb204-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">draw=</span><span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb204-28"><a href="free-space.html#cb204-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha=</span><span class="dv">200</span>, </span>
<span id="cb204-29"><a href="free-space.html#cb204-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.groups =</span> <span class="fu">c</span>(<span class="st">&quot;8w&quot;</span>), </span>
<span id="cb204-30"><a href="free-space.html#cb204-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">border=</span><span class="cn">FALSE</span>)</span>
<span id="cb204-31"><a href="free-space.html#cb204-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiellipse</span>(BC.nmds, </span>
<span id="cb204-32"><a href="free-space.html#cb204-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">groups=</span>meta<span class="sc">$</span>AgeGroup, </span>
<span id="cb204-33"><a href="free-space.html#cb204-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">display=</span><span class="st">&quot;sites&quot;</span>, </span>
<span id="cb204-34"><a href="free-space.html#cb204-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">kind=</span><span class="st">&quot;se&quot;</span>, </span>
<span id="cb204-35"><a href="free-space.html#cb204-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">conf=</span><span class="fl">0.99</span>, </span>
<span id="cb204-36"><a href="free-space.html#cb204-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">label=</span><span class="cn">FALSE</span>, </span>
<span id="cb204-37"><a href="free-space.html#cb204-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">col=</span><span class="st">&quot;blue&quot;</span>, </span>
<span id="cb204-38"><a href="free-space.html#cb204-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">draw=</span><span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb204-39"><a href="free-space.html#cb204-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha=</span><span class="dv">200</span>, </span>
<span id="cb204-40"><a href="free-space.html#cb204-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.groups =</span> <span class="fu">c</span>(<span class="st">&quot;1yr&quot;</span>), </span>
<span id="cb204-41"><a href="free-space.html#cb204-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">border=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/Jaccard%20plot-1.png" width="672" />
<br>
We can see that the Jaccard index for 2 and 8 weeks is quite similair, and that there’s a big difference with the Jaccard index for 1 year. This is all similar to the Bray-Curtis dissimilarity that we saw in the tutorial.</p>

</div>
<p style="text-align: center;">
<a href="cv.html"><button class="btn btn-default">Previous</button></a>
<a href="zotero.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
