<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Looking at the alpha diversity | Portfolio Laurine Seelt" />
<meta property="og:type" content="book" />

<meta property="og:description" content="This is the bookdown for my DSFB2 portfolio" />


<meta name="author" content="Laurine Seelt" />

<meta name="date" content="2022-05-28" />


<meta name="description" content="This is the bookdown for my DSFB2 portfolio">

<title>Looking at the alpha diversity | Portfolio Laurine Seelt</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction">Introduction</a></li>
<li><a href="investigating-a-c.-elegans-plate-experiment.html#investigating-a-c.-elegans-plate-experiment">Investigating a <em>C. Elegans</em> plate experiment</a></li>
<li class="has-sub"><a href="reading-two-different-studies-and-recreating-some-of-the-code.html#reading-two-different-studies-and-recreating-some-of-the-code">Reading two different studies and recreating some of the code</a>
<ul>
<li><a href="part-1.html#part-1">Part 1</a></li>
<li><a href="part-2.html#part-2">Part 2</a></li>
</ul></li>
<li><a href="cleaning-up-according-to-the-guerrilla-analytics-framework.html#cleaning-up-according-to-the-guerrilla-analytics-framework">Cleaning up according to the Guerrilla analytics framework</a></li>
<li><a href="cv.html#cv">CV</a></li>
<li class="has-sub"><a href="free-space.html#free-space">Free space</a>
<ul>
<li><a href="course-microbiota-analysis-in-r.html#course-microbiota-analysis-in-r">Course: Microbiota analysis in R</a></li>
<li><a href="looking-at-the-alpha-diversity.html#looking-at-the-alpha-diversity">Looking at the alpha diversity</a></li>
<li><a href="looking-at-the-beta-diversity.html#looking-at-the-beta-diversity">Looking at the beta diversity</a></li>
<li><a href="otus-that-differ-by.html#otus-that-differ-by">OTU’s that differ by</a></li>
</ul></li>
<li><a href="using-github-and-zotero.html#using-github-and-zotero">Using GitHub and Zotero</a></li>
<li><a href="making-a-website-on-github.html#making-a-website-on-github">Making a website on GitHub</a></li>
<li><a href="working-with-dbeaver-and-sql.html#working-with-dbeaver-and-sql">Working with DBeaver and SQL</a></li>
<li><a href="creating-a-package.html#creating-a-package">Creating a package</a></li>
<li><a href="making-a-parameterized-markdown.html#making-a-parameterized-markdown">Making a parameterized markdown</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="looking-at-the-alpha-diversity" class="section level2">
<h2>Looking at the alpha diversity</h2>
<p><br>
Alpha diversity is the diversity <em>within</em> a sample. It looks at richness, which is the <em>amount</em> of OTU’s in each sample, and at evenness, which is how evenly the different OTU’s are distributed within the sample. <br></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="looking-at-the-alpha-diversity.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a 2x2 plot environment so we can see all 4 metrics at once</span></span>
<span id="cb17-2"><a href="looking-at-the-alpha-diversity.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb17-3"><a href="looking-at-the-alpha-diversity.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the four metrics</span></span>
<span id="cb17-4"><a href="looking-at-the-alpha-diversity.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>shannon, <span class="at">main =</span> <span class="st">&quot;Shannon diversity&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb17-5"><a href="looking-at-the-alpha-diversity.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>simpson, <span class="at">main =</span> <span class="st">&quot;Simpson diversity&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb17-6"><a href="looking-at-the-alpha-diversity.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>chao, <span class="at">main =</span> <span class="st">&quot;Chao richness&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">breaks =</span> <span class="dv">15</span>)</span>
<span id="cb17-7"><a href="looking-at-the-alpha-diversity.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>ace, <span class="at">main =</span> <span class="st">&quot;ACE richness&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">breaks =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/looking%20at%20the%20alpha%20diversity-1.png" width="672" />
<br>
None of the data are normally distributed. Simpson diversity is very often skewed as seen in this histogram, so we’ll calculate 1/Simpson and plot the metrics again.
<br></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="looking-at-the-alpha-diversity.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a 2x2 environment</span></span>
<span id="cb18-2"><a href="looking-at-the-alpha-diversity.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb18-3"><a href="looking-at-the-alpha-diversity.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the four metrics again</span></span>
<span id="cb18-4"><a href="looking-at-the-alpha-diversity.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>shannon, <span class="at">main =</span> <span class="st">&quot;Shannon diversity&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb18-5"><a href="looking-at-the-alpha-diversity.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="dv">1</span><span class="sc">/</span>meta<span class="sc">$</span>simpson, <span class="at">main =</span> <span class="st">&quot;Inverse Simpson diversity&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb18-6"><a href="looking-at-the-alpha-diversity.html#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>chao, <span class="at">main =</span> <span class="st">&quot;Chao richness&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">breaks =</span> <span class="dv">15</span>)</span>
<span id="cb18-7"><a href="looking-at-the-alpha-diversity.html#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meta<span class="sc">$</span>ace, <span class="at">main =</span> <span class="st">&quot;ACE richness&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">breaks =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-5-1.png" width="672" />
<br>
Now the Simpson diversity is distributed similarly to the other richness metrics.
<br>
Next, we’ll test the four metrics for normal distribution.
<br></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="looking-at-the-alpha-diversity.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(meta<span class="sc">$</span>shannon)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  meta$shannon
## W = 0.91511, p-value = 0.0456</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="looking-at-the-alpha-diversity.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="dv">1</span><span class="sc">/</span>meta<span class="sc">$</span>simpson)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  1/meta$simpson
## W = 0.74821, p-value = 4.69e-05</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="looking-at-the-alpha-diversity.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(meta<span class="sc">$</span>chao)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  meta$chao
## W = 0.80636, p-value = 0.0003749</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="looking-at-the-alpha-diversity.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(meta<span class="sc">$</span>ace)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  meta$ace
## W = 0.83017, p-value = 0.0009573</code></pre>
<p><br>
None of the richness metrics are normally distributed, which was to be expected from the graphs we’ve seen. So we cannot run any tests that assume the data is normally distributed.
<br>
For illustration purposes, we’ll run the ANOVA test with the Shannon’s diversity because that’s the closest to normally distributed. We’ll look at if age impacts the Shannon diversity of the fecal microbiota.
<br></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="looking-at-the-alpha-diversity.html#cb27-1" aria-hidden="true" tabindex="-1"></a>aov.shannon.age <span class="ot">=</span> <span class="fu">aov</span>(shannon <span class="sc">~</span> AgeGroup, <span class="at">data =</span> meta)</span>
<span id="cb27-2"><a href="looking-at-the-alpha-diversity.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aov.shannon.age)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## AgeGroup     2  42.98  21.489   103.4 1.35e-11 ***
## Residuals   21   4.36   0.208                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><br>
We’ll run Tukey’s honest significance test to do pairwise comparisons between groups and correct for multiple comparisons.
<br></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="looking-at-the-alpha-diversity.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(aov.shannon.age)</span></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = shannon ~ AgeGroup, data = meta)
## 
## $AgeGroup
##             diff        lwr       upr   p adj
## 2w-1yr -3.270063 -3.8446230 -2.695503 0.0e+00
## 8w-1yr -1.830903 -2.4054628 -1.256342 2.0e-07
## 8w-2w   1.439160  0.8646001  2.013720 8.5e-06</code></pre>
<p><br>
It’s clear that all age groups have significantly different diversity. In a plot, we can clearly see that <em>diversity</em> increases with ages.
<br></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="looking-at-the-alpha-diversity.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-ordering the groups</span></span>
<span id="cb31-2"><a href="looking-at-the-alpha-diversity.html#cb31-2" aria-hidden="true" tabindex="-1"></a>meta<span class="sc">$</span>AgeGroup.ord <span class="ot">=</span> <span class="fu">factor</span>(meta<span class="sc">$</span>AgeGroup, <span class="fu">c</span>(<span class="st">&quot;2w&quot;</span>, <span class="st">&quot;8w&quot;</span>, <span class="st">&quot;1yr&quot;</span>))</span>
<span id="cb31-3"><a href="looking-at-the-alpha-diversity.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Returning the plot area to 1x1</span></span>
<span id="cb31-4"><a href="looking-at-the-alpha-diversity.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb31-5"><a href="looking-at-the-alpha-diversity.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the diversity</span></span>
<span id="cb31-6"><a href="looking-at-the-alpha-diversity.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(shannon <span class="sc">~</span> AgeGroup.ord, <span class="at">data =</span> meta, </span>
<span id="cb31-7"><a href="looking-at-the-alpha-diversity.html#cb31-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Shannon&#39;s diversity&quot;</span>,</span>
<span id="cb31-8"><a href="looking-at-the-alpha-diversity.html#cb31-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Age group&quot;</span>) <span class="co"># Added the xlab myself because it looks better :)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20the%20diversity-1.png" width="672" />
<br>
To illustrate some non-parametric tests, we’ll use Chao’s richness estimate. Age is categorical, so we’ll use Kruskal-Wallis.
<br></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="looking-at-the-alpha-diversity.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(chao <span class="sc">~</span> AgeGroup, <span class="at">data =</span> meta)</span></code></pre></div>
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  chao by AgeGroup
## Kruskal-Wallis chi-squared = 19.28, df = 2, p-value = 6.507e-05</code></pre>
<p><br>
We can also test pairwise within age groups with Wilcoxon Rank Sum Tests.
<br></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="looking-at-the-alpha-diversity.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.wilcox.test</span>(meta<span class="sc">$</span>chao, meta<span class="sc">$</span>AgeGroup, <span class="at">p.adjust.method =</span> <span class="st">&quot;fdr&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Pairwise comparisons using Wilcoxon rank sum exact test 
## 
## data:  meta$chao and meta$AgeGroup 
## 
##    1yr     2w     
## 2w 0.00023 -      
## 8w 0.00023 0.00186
## 
## P value adjustment method: fdr</code></pre>
<p><br>
Just like the diversity, <strong>richness</strong> also increases with age.
<br></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="looking-at-the-alpha-diversity.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a 1x1 plot environment</span></span>
<span id="cb36-2"><a href="looking-at-the-alpha-diversity.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb36-3"><a href="looking-at-the-alpha-diversity.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the richness</span></span>
<span id="cb36-4"><a href="looking-at-the-alpha-diversity.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(chao <span class="sc">~</span> AgeGroup.ord, <span class="at">data =</span> meta,</span>
<span id="cb36-5"><a href="looking-at-the-alpha-diversity.html#cb36-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Chao richness&quot;</span>,</span>
<span id="cb36-6"><a href="looking-at-the-alpha-diversity.html#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Age group&quot;</span>) <span class="co"># Again, added the xlab myself for aesthetics :)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20the%20richness-1.png" width="672" />
<br>
Average Daily Gain is a continuous variable, so we’ll use a linear model to visualise it.
<br>
We’ll use Shannon’s diversity again to run some tests that are meant for normally distributed data. We’ll take a look at if the ADG impacts the Shannon diversity of the fecal microbiota.
<br></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="looking-at-the-alpha-diversity.html#cb37-1" aria-hidden="true" tabindex="-1"></a>glm.shannon.ADG <span class="ot">=</span> <span class="fu">glm</span>(shannon <span class="sc">~</span> ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb37-2"><a href="looking-at-the-alpha-diversity.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.shannon.ADG)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = shannon ~ ADGKG, data = meta)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.49110  -1.11216  -0.01749   1.53658   1.84728  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  3.62565    1.01390   3.576  0.00169 **
## ADGKG       -0.03407    0.97805  -0.035  0.97253   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 2.151815)
## 
##     Null deviance: 47.343  on 23  degrees of freedom
## Residual deviance: 47.340  on 22  degrees of freedom
## AIC: 90.412
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p><br>
This shows that the intercept of our model is signficantly different from 0, bu the slope is not, and the slope is our variable of interest.
<br>
Next, let’s plot the glm.
<br></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="looking-at-the-alpha-diversity.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(shannon <span class="sc">~</span> ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb39-2"><a href="looking-at-the-alpha-diversity.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(glm.shannon.ADG)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20the%20glm-1.png" width="672" />
<br>
To illustrate non-normally distributed data, we’ll use Chao’s richness estimate again. We’ll first use the Gaussian distribution, but we already know this isn’t a good fit.
<br></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="looking-at-the-alpha-diversity.html#cb40-1" aria-hidden="true" tabindex="-1"></a>gaussian.chao.adg <span class="ot">=</span> <span class="fu">glm</span>(chao <span class="sc">~</span>ADGKG, <span class="at">data =</span> meta, <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>)</span>
<span id="cb40-2"><a href="looking-at-the-alpha-diversity.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb40-3"><a href="looking-at-the-alpha-diversity.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gaussian.chao.adg, <span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20Gaussian-1.png" width="672" />
<br>
Next, we’ll plot the quasipoisson distribuiton.
<br></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="looking-at-the-alpha-diversity.html#cb41-1" aria-hidden="true" tabindex="-1"></a>qp.chao.ADG <span class="ot">=</span> <span class="fu">glm</span>(chao <span class="sc">~</span> ADGKG, <span class="at">data =</span> meta, <span class="at">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span>
<span id="cb41-2"><a href="looking-at-the-alpha-diversity.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb41-3"><a href="looking-at-the-alpha-diversity.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(qp.chao.ADG, <span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20quasipoisson-1.png" width="672" />
<br>
The quasipoisson distribution fits much better than the Gaussian distribution, so we’ll use quasipoisson for further calculations.
<br></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="looking-at-the-alpha-diversity.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(qp.chao.ADG)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = chao ~ ADGKG, family = &quot;quasipoisson&quot;, data = meta)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -24.36  -17.05  -10.66   18.81   26.91  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   6.4528     0.5561  11.605 7.54e-11 ***
## ADGKG        -0.1859     0.5438  -0.342    0.736    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 374.2485)
## 
##     Null deviance: 8117.2  on 23  degrees of freedom
## Residual deviance: 8074.4  on 22  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p><br>
We’ll plot Chao and ADGKG again, to look at the correlation.
<br></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="looking-at-the-alpha-diversity.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb44-2"><a href="looking-at-the-alpha-diversity.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(chao) <span class="sc">~</span> ADGKG, <span class="at">data =</span> meta, <span class="at">ylab =</span> <span class="st">&quot;ln(Chao&#39;s richness)&quot;</span>)</span>
<span id="cb44-3"><a href="looking-at-the-alpha-diversity.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(qp.chao.ADG)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotting%20Chao%20and%20ADGKG-1.png" width="672" />
<br>
Looking at the graph, there is nog significant correlation between Chao’s richness and the Average Daily Gain.
<br>
To test if age and ADG impacts diversity, we’ll conduct an ANOVA test.
<br></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="looking-at-the-alpha-diversity.html#cb45-1" aria-hidden="true" tabindex="-1"></a>aov.shannon.all <span class="ot">=</span> <span class="fu">aov</span>(shannon <span class="sc">~</span> AgeGroup<span class="sc">*</span>ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb45-2"><a href="looking-at-the-alpha-diversity.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aov.shannon.all)</span></code></pre></div>
<pre><code>##                Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## AgeGroup        2  42.98  21.489  95.472 2.61e-10 ***
## ADGKG           1   0.05   0.054   0.239    0.631    
## AgeGroup:ADGKG  2   0.26   0.130   0.576    0.572    
## Residuals      18   4.05   0.225                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><br>
We can see that the interaction between age and ADG does not significantly impact Shannon’s diversity, so we’ll remove that variable and run the test again.
<br></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="looking-at-the-alpha-diversity.html#cb47-1" aria-hidden="true" tabindex="-1"></a>aov.shannon.all2 <span class="ot">=</span> <span class="fu">aov</span>(shannon <span class="sc">~</span> AgeGroup<span class="sc">+</span>ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb47-2"><a href="looking-at-the-alpha-diversity.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aov.shannon.all2)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## AgeGroup     2  42.98  21.489   99.70 3.96e-11 ***
## ADGKG        1   0.05   0.054    0.25    0.623    
## Residuals   20   4.31   0.216                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><br>
This test tells us that only age impacts Shannon’s diversity significantly, but we do not know which age groups differ significantly from eachother. To test this, we can run TukeyHSD with just age.
<br></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="looking-at-the-alpha-diversity.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(aov.shannon.all)</span></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = shannon ~ AgeGroup * ADGKG, data = meta)
## 
## $AgeGroup
##             diff       lwr       upr    p adj
## 2w-1yr -3.270063 -3.875469 -2.664657 0.00e+00
## 8w-1yr -1.830903 -2.436309 -1.225496 1.20e-06
## 8w-2w   1.439160  0.833754  2.044567 2.81e-05</code></pre>
<p><br>
With this test, however, ADGKG is ignored because it’s continuous. <br>
We’ll run the glm instead.
<br></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="looking-at-the-alpha-diversity.html#cb51-1" aria-hidden="true" tabindex="-1"></a>glm.shannon.all <span class="ot">=</span> <span class="fu">glm</span>(shannon <span class="sc">~</span> AgeGroup<span class="sc">*</span>ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb51-2"><a href="looking-at-the-alpha-diversity.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.shannon.all)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = shannon ~ AgeGroup * ADGKG, data = meta)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.0301  -0.2468   0.0894   0.1572   0.7624  
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)        5.7123     2.5928   2.203   0.0409 *
## AgeGroup2w        -3.3969     2.6197  -1.297   0.2111  
## AgeGroup8w        -2.9610     2.7554  -1.075   0.2967  
## ADGKG             -0.4481     2.7599  -0.162   0.8728  
## AgeGroup2w:ADGKG   0.1228     2.7848   0.044   0.9653  
## AgeGroup8w:ADGKG   1.0750     2.8763   0.374   0.7130  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.22508)
## 
##     Null deviance: 47.3425  on 23  degrees of freedom
## Residual deviance:  4.0514  on 18  degrees of freedom
## AIC: 39.413
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p><br>
We can see that none of the interaction terms, which are AgeGroup2w:ADGKG and AgeGroup8w:ADGKG, are significant. So we’ll remove these, by changing AgeGroup*ADGKG to AgeGroup+ADGKG, and run the glm again.
<br></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="looking-at-the-alpha-diversity.html#cb53-1" aria-hidden="true" tabindex="-1"></a>glm.shannon.all2 <span class="ot">=</span> <span class="fu">glm</span>(shannon <span class="sc">~</span> AgeGroup<span class="sc">+</span>ADGKG, <span class="at">data =</span> meta)</span>
<span id="cb53-2"><a href="looking-at-the-alpha-diversity.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.shannon.all2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = shannon ~ AgeGroup + ADGKG, data = meta)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.95299  -0.25858   0.07643   0.30409   0.74487  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   5.4459     0.3487  15.619 1.14e-12 ***
## AgeGroup2w   -3.2760     0.2324 -14.094 7.55e-12 ***
## AgeGroup8w   -1.7989     0.2408  -7.471 3.30e-07 ***
## ADGKG        -0.1639     0.3281  -0.500    0.623    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.2155447)
## 
##     Null deviance: 47.3425  on 23  degrees of freedom
## Residual deviance:  4.3109  on 20  degrees of freedom
## AIC: 36.903
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p><br>
Now that we’ve removed the interaction terms, the glm model shows age as significant.
<br>
This can also be done with non-normally distributed data, like Chao’s richness.
<br></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="looking-at-the-alpha-diversity.html#cb55-1" aria-hidden="true" tabindex="-1"></a>qp.chao.all <span class="ot">=</span> <span class="fu">glm</span>(chao <span class="sc">~</span> AgeGroup<span class="sc">*</span>ADGKG, <span class="at">data =</span> meta, <span class="at">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span>
<span id="cb55-2"><a href="looking-at-the-alpha-diversity.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(qp.chao.all)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = chao ~ AgeGroup * ADGKG, family = &quot;quasipoisson&quot;, 
##     data = meta)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -7.774  -3.430  -0.140   3.692   5.277  
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       6.99825    0.71122   9.840 1.14e-08 ***
## AgeGroup2w       -1.61539    0.75272  -2.146   0.0458 *  
## AgeGroup8w       -2.24498    0.86846  -2.585   0.0187 *  
## ADGKG             0.01751    0.75699   0.023   0.9818    
## AgeGroup2w:ADGKG -0.42295    0.80094  -0.528   0.6039    
## AgeGroup8w:ADGKG  0.86269    0.86550   0.997   0.3321    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 18.86331)
## 
##     Null deviance: 8117.2  on 23  degrees of freedom
## Residual deviance:  348.5  on 18  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><br>
Just like the Shannon’s diversity, the interaction terms are not significant, so we’ll remove those and run the glm again.
<br></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="looking-at-the-alpha-diversity.html#cb57-1" aria-hidden="true" tabindex="-1"></a>qp.chao.all2 <span class="ot">=</span> <span class="fu">glm</span>(chao <span class="sc">~</span> AgeGroup<span class="sc">+</span>ADGKG, <span class="at">data =</span> meta, <span class="at">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span>
<span id="cb57-2"><a href="looking-at-the-alpha-diversity.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(qp.chao.all2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = chao ~ AgeGroup + ADGKG, family = &quot;quasipoisson&quot;, 
##     data = meta)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -7.783  -3.452  -1.378   3.744   8.184  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  7.03944    0.23567  29.870  &lt; 2e-16 ***
## AgeGroup2w  -1.98090    0.14862 -13.329 2.08e-11 ***
## AgeGroup8w  -1.24286    0.11926 -10.422 1.57e-09 ***
## ADGKG       -0.02643    0.24530  -0.108    0.915    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 23.74583)
## 
##     Null deviance: 8117.20  on 23  degrees of freedom
## Residual deviance:  476.31  on 20  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><br>
As we can see, age is now significant for richness aswell.
<br>
We sampled the same animals over time, so this is a repeated measures design. We can add this component with (1|animal) in the lmer function.
<br></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="looking-at-the-alpha-diversity.html#cb59-1" aria-hidden="true" tabindex="-1"></a>rm.shannon.all <span class="ot">=</span> <span class="fu">lmer</span>(shannon <span class="sc">~</span> AgeGroup<span class="sc">+</span>ADGKG <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Animal), <span class="at">data =</span> meta)</span>
<span id="cb59-2"><a href="looking-at-the-alpha-diversity.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rm.shannon.all)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: shannon ~ AgeGroup + ADGKG + (1 | Animal)
##    Data: meta
## 
## REML criterion at convergence: 32.4
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.83117 -0.45932  0.09539  0.49972  1.53368 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Animal   (Intercept) 0.03793  0.1948  
##  Residual             0.17819  0.4221  
## Number of obs: 24, groups:  Animal, 8
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   5.3906     0.3520  15.313
## AgeGroup2w   -3.2739     0.2114 -15.486
## AgeGroup8w   -1.8104     0.2208  -8.201
## ADGKG        -0.1049     0.3321  -0.316
## 
## Correlation of Fixed Effects:
##            (Intr) AgGrp2 AgGrp8
## AgeGroup2w -0.350              
## AgeGroup8w -0.027  0.461       
## ADGKG      -0.884  0.057 -0.293</code></pre>
<p><br>
Very little, 0.0379, of the variance is explained by the animal random effect. This means that we don’t have to include the repeated measures in our final model, but it did need to be checked!
<br>
In conclusion on the alpha diversity: The diversity and richness of the fecal microbiota increases as the dairy cows age. Animal growth, measured by ADG, does not correlate with the diversity or richness of the fecal community.
<br>
<br></p>
</div>
<p style="text-align: center;">
<a href="course-microbiota-analysis-in-r.html"><button class="btn btn-default">Previous</button></a>
<a href="looking-at-the-beta-diversity.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
